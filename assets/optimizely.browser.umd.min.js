!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.optimizelySdk=t():e.optimizelySdk=t()}(window,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=84)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(49);function i(e){return Object.keys(e).map(function(t){return e[t]})}t.getTimestamp=function(){return(new Date).getTime()},t.generateUUID=function(){return n.v4()},t.isValidEnum=function(e,t){for(var r=!1,n=Object.keys(e),i=0;i<n.length;i++)if(t===e[n[i]]){r=!0;break}return r},t.groupBy=function(e,t){var r={};return e.forEach(function(e){var n=t(e);r[n]=r[n]||[],r[n].push(e)}),i(r)},t.objectValues=i,t.find=function(e,t){for(var r,n=0,i=e;n<i.length;n++){var o=i[n];if(t(o)){r=o;break}}return r},t.keyBy=function(e,t){var r={};return e.forEach(function(e){var n=t(e);r[n]=e}),r},t.sprintf=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];var n=0;return e.replace(/%s/g,function(){var e=t[n++],r=typeof e;return"function"===r?e():"string"===r?e:String(e)})}},function(e,t){var r=Array.isArray;e.exports=r},function(e,t){t.LOG_LEVEL={NOTSET:0,DEBUG:1,INFO:2,WARNING:3,ERROR:4},t.ERROR_MESSAGES={EXPERIMENT_KEY_NOT_IN_DATAFILE:"%s: Experiment key %s is not in datafile.",FEATURE_NOT_IN_DATAFILE:"%s: Feature key %s is not in datafile.",IMPROPERLY_FORMATTED_EXPERIMENT:"%s: Experiment key %s is improperly formatted.",INVALID_ATTRIBUTES:"%s: Provided attributes are in an invalid format.",INVALID_BUCKETING_ID:"%s: Unable to generate hash for bucketing ID %s: %s",INVALID_DATAFILE:"%s: Datafile is invalid - property %s: %s",INVALID_DATAFILE_MALFORMED:"%s: Datafile is invalid because it is malformed.",INVALID_JSON:"%s: JSON object is not valid.",INVALID_ERROR_HANDLER:'%s: Provided "errorHandler" is in an invalid format.',INVALID_EVENT_DISPATCHER:'%s: Provided "eventDispatcher" is in an invalid format.',INVALID_EVENT_KEY:"%s: Event key %s is not in datafile.",INVALID_EVENT_TAGS:"%s: Provided event tags are in an invalid format.",INVALID_EXPERIMENT_KEY:"%s: Experiment key %s is not in datafile. It is either invalid, paused, or archived.",INVALID_EXPERIMENT_ID:"%s: Experiment ID %s is not in datafile.",INVALID_GROUP_ID:"%s: Group ID %s is not in datafile.",INVALID_LOGGER:'%s: Provided "logger" is in an invalid format.',INVALID_ROLLOUT_ID:"%s: Invalid rollout ID %s attached to feature %s",INVALID_USER_ID:"%s: Provided user ID is in an invalid format.",INVALID_USER_PROFILE_SERVICE:"%s: Provided user profile service instance is in an invalid format: %s.",JSON_SCHEMA_EXPECTED:"%s: JSON schema expected.",NO_DATAFILE_SPECIFIED:"%s: No datafile specified. Cannot start optimizely.",NO_JSON_PROVIDED:"%s: No JSON object to validate against schema.",NO_VARIATION_FOR_EXPERIMENT_KEY:"%s: No variation key %s defined in datafile for experiment %s.",UNDEFINED_ATTRIBUTE:"%s: Provided attribute: %s has an undefined value.",UNRECOGNIZED_ATTRIBUTE:"%s: Unrecognized attribute %s provided. Pruning before sending event to Optimizely.",UNABLE_TO_CAST_VALUE:"%s: Unable to cast value %s to type %s, returning null.",USER_NOT_IN_FORCED_VARIATION:"%s: User %s is not in the forced variation map. Cannot remove their forced variation.",USER_PROFILE_LOOKUP_ERROR:'%s: Error while looking up user profile for user ID "%s": %s.',USER_PROFILE_SAVE_ERROR:'%s: Error while saving user profile for user ID "%s": %s.',VARIABLE_KEY_NOT_IN_DATAFILE:'%s: Variable with key "%s" associated with feature with key "%s" is not in datafile.',VARIATION_ID_NOT_IN_DATAFILE:"%s: No variation ID %s defined in datafile for experiment %s.",VARIATION_ID_NOT_IN_DATAFILE_NO_EXPERIMENT:"%s: Variation ID %s is not in the datafile.",INVALID_INPUT_FORMAT:"%s: Provided %s is in an invalid format.",INVALID_DATAFILE_VERSION:"%s: This version of the JavaScript SDK does not support the given datafile version: %s",INVALID_VARIATION_KEY:"%s: Provided variation key is in an invalid format."},t.LOG_MESSAGES={ACTIVATE_USER:"%s: Activating user %s in experiment %s.",DISPATCH_CONVERSION_EVENT:"%s: Dispatching conversion event to URL %s with params %s.",DISPATCH_IMPRESSION_EVENT:"%s: Dispatching impression event to URL %s with params %s.",DEPRECATED_EVENT_VALUE:"%s: Event value is deprecated in %s call.",EXPERIMENT_NOT_RUNNING:"%s: Experiment %s is not running.",FEATURE_ENABLED_FOR_USER:"%s: Feature %s is enabled for user %s.",FEATURE_NOT_ENABLED_FOR_USER:"%s: Feature %s is not enabled for user %s.",FEATURE_HAS_NO_EXPERIMENTS:"%s: Feature %s is not attached to any experiments.",FAILED_TO_PARSE_VALUE:'%s: Failed to parse event value "%s" from event tags.',FAILED_TO_PARSE_REVENUE:'%s: Failed to parse revenue value "%s" from event tags.',FORCED_BUCKETING_FAILED:"%s: Variation key %s is not in datafile. Not activating user %s.",INVALID_OBJECT:"%s: Optimizely object is not valid. Failing %s.",INVALID_CLIENT_ENGINE:"%s: Invalid client engine passed: %s. Defaulting to node-sdk.",INVALID_VARIATION_ID:"%s: Bucketed into an invalid variation ID. Returning null.",NOTIFICATION_LISTENER_EXCEPTION:"%s: Notification listener for (%s) threw exception: %s",NO_ROLLOUT_EXISTS:"%s: There is no rollout of feature %s.",NOT_ACTIVATING_USER:"%s: Not activating user %s for experiment %s.",NOT_TRACKING_USER:"%s: Not tracking user %s.",PARSED_REVENUE_VALUE:'%s: Parsed revenue value "%s" from event tags.',PARSED_NUMERIC_VALUE:'%s: Parsed event value "%s" from event tags.',RETURNING_STORED_VARIATION:'%s: Returning previously activated variation "%s" of experiment "%s" for user "%s" from user profile.',ROLLOUT_HAS_NO_EXPERIMENTS:"%s: Rollout of feature %s has no experiments",SAVED_VARIATION:'%s: Saved variation "%s" of experiment "%s" for user "%s".',SAVED_VARIATION_NOT_FOUND:"%s: User %s was previously bucketed into variation with ID %s for experiment %s, but no matching variation was found.",SHOULD_NOT_DISPATCH_ACTIVATE:'%s: Experiment %s is in "Launched" state. Not activating user.',SKIPPING_JSON_VALIDATION:"%s: Skipping JSON schema validation.",TRACK_EVENT:"%s: Tracking event %s for user %s.",USER_ASSIGNED_TO_VARIATION_BUCKET:"%s: Assigned variation bucket %s to user %s.",USER_ASSIGNED_TO_EXPERIMENT_BUCKET:"%s: Assigned experiment bucket %s to user %s.",USER_BUCKETED_INTO_EXPERIMENT_IN_GROUP:"%s: User %s is in experiment %s of group %s.",USER_BUCKETED_INTO_TARGETING_RULE:"%s: User %s bucketed into targeting rule %s.",USER_IN_FEATURE_EXPERIMENT:"%s: User %s is in variation %s of experiment %s on the feature %s.",USER_IN_ROLLOUT:"%s: User %s is in rollout of feature %s.",USER_BUCKETED_INTO_EVERYONE_TARGETING_RULE:"%s: User %s bucketed into everyone targeting rule.",USER_NOT_BUCKETED_INTO_EVERYONE_TARGETING_RULE:"%s: User %s not bucketed into everyone targeting rule due to traffic allocation.",USER_NOT_BUCKETED_INTO_EXPERIMENT_IN_GROUP:"%s: User %s is not in experiment %s of group %s.",USER_NOT_BUCKETED_INTO_ANY_EXPERIMENT_IN_GROUP:"%s: User %s is not in any experiment of group %s.",USER_NOT_BUCKETED_INTO_TARGETING_RULE:"%s User %s not bucketed into targeting rule %s due to traffic allocation. Trying everyone rule.",USER_NOT_IN_FEATURE_EXPERIMENT:"%s: User %s is not in any experiment on the feature %s.",USER_NOT_IN_ROLLOUT:"%s: User %s is not in rollout of feature %s.",USER_FORCED_IN_VARIATION:"%s: User %s is forced in variation %s.",USER_MAPPED_TO_FORCED_VARIATION:"%s: Set variation %s for experiment %s and user %s in the forced variation map.",USER_DOESNT_MEET_CONDITIONS_FOR_TARGETING_RULE:"%s: User %s does not meet conditions for targeting rule %s.",USER_MEETS_CONDITIONS_FOR_TARGETING_RULE:"%s: User %s meets conditions for targeting rule %s.",USER_HAS_VARIATION:"%s: User %s is in variation %s of experiment %s.",USER_HAS_FORCED_VARIATION:"%s: Variation %s is mapped to experiment %s and user %s in the forced variation map.",USER_HAS_NO_VARIATION:"%s: User %s is in no variation of experiment %s.",USER_HAS_NO_FORCED_VARIATION:"%s: User %s is not in the forced variation map.",USER_HAS_NO_FORCED_VARIATION_FOR_EXPERIMENT:"%s: No experiment %s mapped to user %s in the forced variation map.",USER_NOT_IN_ANY_EXPERIMENT:"%s: User %s is not in any experiment of group %s.",USER_NOT_IN_EXPERIMENT:"%s: User %s does not meet conditions to be in experiment %s.",USER_RECEIVED_DEFAULT_VARIABLE_VALUE:'%s: User "%s" is not in any variation or rollout rule. Returning default value for variable "%s" of feature flag "%s".',FEATURE_NOT_ENABLED_RETURN_DEFAULT_VARIABLE_VALUE:'%s: Feature "%s" is not enabled for user %s. Returning default value for variable "%s".',VARIABLE_NOT_USED_RETURN_DEFAULT_VARIABLE_VALUE:'%s: Variable "%s" is not used in variation "%s". Returning default value.',USER_RECEIVED_VARIABLE_VALUE:'%s: Value for variable "%s" of feature flag "%s" is %s for user "%s"',VALID_DATAFILE:"%s: Datafile is valid.",VALID_USER_PROFILE_SERVICE:"%s: Valid user profile service provided.",VARIATION_REMOVED_FOR_USER:"%s: Variation mapped to experiment %s has been removed for user %s.",VARIABLE_REQUESTED_WITH_WRONG_TYPE:'%s: Requested variable type "%s", but variable is of type "%s". Use correct API to retrieve value. Returning None.',VALID_BUCKETING_ID:'%s: BucketingId is valid: "%s"',BUCKETING_ID_NOT_STRING:"%s: BucketingID attribute is not a string. Defaulted to userId",EVALUATING_AUDIENCE:'%s: Starting to evaluate audience "%s" with conditions: %s.',EVALUATING_AUDIENCES_COMBINED:'%s: Evaluating audiences for experiment "%s": %s.',AUDIENCE_EVALUATION_RESULT:'%s: Audience "%s" evaluated to %s.',AUDIENCE_EVALUATION_RESULT_COMBINED:"%s: Audiences for experiment %s collectively evaluated to %s.",MISSING_ATTRIBUTE_VALUE:'%s: Audience condition %s evaluated to UNKNOWN because no value was passed for user attribute "%s".',UNEXPECTED_CONDITION_VALUE:"%s: Audience condition %s evaluated to UNKNOWN because the condition value is not supported.",UNEXPECTED_TYPE:'%s: Audience condition %s evaluated to UNKNOWN because a value of type "%s" was passed for user attribute "%s".',UNEXPECTED_TYPE_NULL:'%s: Audience condition %s evaluated to UNKNOWN because a null value was passed for user attribute "%s".',UNKNOWN_CONDITION_TYPE:"%s: Audience condition %s has an unknown condition type. You may need to upgrade to a newer release of the Optimizely SDK.",UNKNOWN_MATCH_TYPE:"%s: Audience condition %s uses an unknown match type. You may need to upgrade to a newer release of the Optimizely SDK.",OUT_OF_BOUNDS:'%s: Audience condition %s evaluated to UNKNOWN because the number value for user attribute "%s" is not in the range [-2^53, +2^53].'},t.RESERVED_EVENT_KEYWORDS={REVENUE:"revenue",VALUE:"value"},t.CONTROL_ATTRIBUTES={BOT_FILTERING:"$opt_bot_filtering",BUCKETING_ID:"$opt_bucketing_id",STICKY_BUCKETING_KEY:"$opt_experiment_bucket_map",USER_AGENT:"$opt_user_agent"},t.JAVASCRIPT_CLIENT_ENGINE="javascript-sdk",t.NODE_CLIENT_ENGINE="node-sdk",t.NODE_CLIENT_VERSION="3.1.0",t.NOTIFICATION_TYPES={ACTIVATE:"ACTIVATE:experiment, user_id,attributes, variation, event",DECISION:"DECISION:type, userId, attributes, decisionInfo",TRACK:"TRACK:event_key, user_id, attributes, event_tags, event"},t.DECISION_NOTIFICATION_TYPES={AB_TEST:"ab-test",FEATURE:"feature",FEATURE_TEST:"feature-test",FEATURE_VARIABLE:"feature-variable"},t.DECISION_SOURCES={FEATURE_TEST:"feature-test",ROLLOUT:"rollout"},t.FEATURE_VARIABLE_TYPES={BOOLEAN:"boolean",DOUBLE:"double",INTEGER:"integer",STRING:"string"},t.DATAFILE_VERSIONS={V2:"2",V3:"3",V4:"4"}},function(e,t,r){var n=r(52),i="object"==typeof self&&self&&self.Object===Object&&self,o=n||i||Function("return this")();e.exports=o},function(e,t,r){var n=r(49),i=r(89),o=Math.pow(2,53);e.exports={assign:r(90),assignIn:r(110),cloneDeep:r(113),currentTimestamp:function(){return Math.round((new Date).getTime())},isArray:r(1),isEmpty:r(160),isFinite:function(e){return i(e)&&Math.abs(e)<=o},keyBy:r(161),filter:r(194),forEach:r(196),forOwn:r(77),map:r(197),uuid:function(){return n.v4()},values:r(199),isNumber:r(201)}},function(e,t){e.exports=function(e){return null!=e&&"object"==typeof e}},function(e,t,r){var n=r(91),i=r(96);e.exports=function(e,t){var r=i(e,t);return n(r)?r:void 0}},function(e,t){e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},function(e,t,r){var n=r(54),i=r(28);e.exports=function(e){return null!=e&&i(e.length)&&!n(e)}},function(e,t,r){var n=r(57),i=r(58),o=r(8);e.exports=function(e){return o(e)?n(e):i(e)}},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(47)),n(r(48)),n(r(86))},function(e,t,r){var n=r(13),i=r(92),o=r(93),a="[object Null]",s="[object Undefined]",u=n?n.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?s:a:u&&u in Object(e)?i(e):o(e)}},function(e,t,r){var n=r(26),i=r(27);e.exports=function(e,t,r,o){var a=!r;r||(r={});for(var s=-1,u=t.length;++s<u;){var c=t[s],l=o?o(r[c],e[c],c,r,e):void 0;void 0===l&&(l=e[c]),a?i(r,c,l):n(r,c,l)}return r}},function(e,t,r){var n=r(3).Symbol;e.exports=n},function(e,t){var r=Object.prototype;e.exports=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||r)}},function(e,t,r){var n=r(144),i=r(37),o=r(145),a=r(146),s=r(147),u=r(11),c=r(55),l=c(n),f=c(i),p=c(o),E=c(a),_=c(s),v=u;(n&&"[object DataView]"!=v(new n(new ArrayBuffer(1)))||i&&"[object Map]"!=v(new i)||o&&"[object Promise]"!=v(o.resolve())||a&&"[object Set]"!=v(new a)||s&&"[object WeakMap]"!=v(new s))&&(v=function(e){var t=u(e),r="[object Object]"==t?e.constructor:void 0,n=r?c(r):"";if(n)switch(n){case l:return"[object DataView]";case f:return"[object Map]";case p:return"[object Promise]";case E:return"[object Set]";case _:return"[object WeakMap]"}return t}),e.exports=v},function(e,t){e.exports=function(e,t){return e===t||e!=e&&t!=t}},function(e,t){e.exports=function(e){return e}},function(e,t,r){(function(e){var n=r(3),i=r(107),o=t&&!t.nodeType&&t,a=o&&"object"==typeof e&&e&&!e.nodeType&&e,s=a&&a.exports===o?n.Buffer:void 0,u=(s?s.isBuffer:void 0)||i;e.exports=u}).call(this,r(31)(e))},function(e,t,r){var n=r(115),i=r(116),o=r(117),a=r(118),s=r(119);function u(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}u.prototype.clear=n,u.prototype.delete=i,u.prototype.get=o,u.prototype.has=a,u.prototype.set=s,e.exports=u},function(e,t,r){var n=r(16);e.exports=function(e,t){for(var r=e.length;r--;)if(n(e[r][0],t))return r;return-1}},function(e,t,r){var n=r(6)(Object,"create");e.exports=n},function(e,t,r){var n=r(133);e.exports=function(e,t){var r=e.__data__;return n(t)?r["string"==typeof t?"string":"hash"]:r.map}},function(e,t,r){var n=r(69),i=r(167)(n);e.exports=i},function(e,t,r){var n=r(43),i=1/0;e.exports=function(e){if("string"==typeof e||n(e))return e;var t=e+"";return"0"==t&&1/e==-i?"-0":t}},function(e,t,r){var n=r(4),i=r(2),o=r(0).sprintf,a=r(82),s="PROJECT_CONFIG",u=i.ERROR_MESSAGES,c=i.LOG_MESSAGES,l=i.LOG_LEVEL,f=i.FEATURE_VARIABLE_TYPES;e.exports={createProjectConfig:function(e){var t,r=n.cloneDeep(e);return n.forEach(r.audiences,function(e){e.conditions=JSON.parse(e.conditions)}),r.audiencesById=n.keyBy(r.audiences,"id"),n.assign(r.audiencesById,n.keyBy(r.typedAudiences,"id")),r.attributeKeyMap=n.keyBy(r.attributes,"key"),r.eventKeyMap=n.keyBy(r.events,"key"),r.groupIdMap=n.keyBy(r.groups,"id"),n.forEach(r.groupIdMap,function(e,i){t=n.cloneDeep(e.experiments),n.forEach(t,function(e){r.experiments.push(n.assignIn(e,{groupId:i}))})}),r.rolloutIdMap=n.keyBy(r.rollouts||[],"id"),n.forOwn(r.rolloutIdMap,function(e){n.forEach(e.experiments||[],function(e){r.experiments.push(n.cloneDeep(e)),e.variationKeyMap=n.keyBy(e.variations,"key")})}),r.experimentKeyMap=n.keyBy(r.experiments,"key"),r.experimentIdMap=n.keyBy(r.experiments,"id"),r.variationIdMap={},r.variationVariableUsageMap={},n.forEach(r.experiments,function(e){e.variationKeyMap=n.keyBy(e.variations,"key"),n.assignIn(r.variationIdMap,n.keyBy(e.variations,"id")),n.forOwn(e.variationKeyMap,function(e){e.variables&&(r.variationVariableUsageMap[e.id]=n.keyBy(e.variables,"id"))})}),r.forcedVariationMap={},r.experimentFeatureMap={},r.featureKeyMap=n.keyBy(r.featureFlags||[],"key"),n.forOwn(r.featureKeyMap,function(e){e.variableKeyMap=n.keyBy(e.variables,"key"),n.forEach(e.experimentIds||[],function(t){r.experimentFeatureMap[t]?r.experimentFeatureMap[t].push(e.id):r.experimentFeatureMap[t]=[e.id];var n=r.experimentIdMap[t];if(n.groupId)return e.groupId=n.groupId,!1})}),r},getExperimentId:function(e,t){var r=e.experimentKeyMap[t];if(n.isEmpty(r))throw new Error(o(u.INVALID_EXPERIMENT_KEY,s,t));return r.id},getLayerId:function(e,t){var r=e.experimentIdMap[t];if(n.isEmpty(r))throw new Error(o(u.INVALID_EXPERIMENT_ID,s,t));return r.layerId},getAttributeId:function(e,t,r){var n=e.attributeKeyMap[t],i=0===t.indexOf("$opt_");return n?(i&&r.log(l.WARN,o("Attribute %s unexpectedly has reserved prefix %s; using attribute ID instead of reserved attribute name.",t,"$opt_")),n.id):i?t:(r.log(l.DEBUG,o(u.UNRECOGNIZED_ATTRIBUTE,s,t)),null)},getEventId:function(e,t){var r=e.eventKeyMap[t];return r?r.id:null},getExperimentStatus:function(e,t){var r=e.experimentKeyMap[t];if(n.isEmpty(r))throw new Error(o(u.INVALID_EXPERIMENT_KEY,s,t));return r.status},isActive:function(t,r){return"Running"===e.exports.getExperimentStatus(t,r)||"Launched"===e.exports.getExperimentStatus(t,r)},isRunning:function(t,r){return"Running"===e.exports.getExperimentStatus(t,r)},getExperimentAudienceConditions:function(e,t){var r=e.experimentKeyMap[t];if(n.isEmpty(r))throw new Error(o(u.INVALID_EXPERIMENT_KEY,s,t));return r.audienceConditions||r.audienceIds},getVariationKeyFromId:function(e,t){return e.variationIdMap.hasOwnProperty(t)?e.variationIdMap[t].key:null},getVariationIdFromExperimentAndVariationKey:function(e,t,r){var n=e.experimentKeyMap[t];return n.variationKeyMap.hasOwnProperty(r)?n.variationKeyMap[r].id:null},getExperimentFromKey:function(e,t){if(e.experimentKeyMap.hasOwnProperty(t)){var r=e.experimentKeyMap[t];if(r)return r}throw new Error(o(u.EXPERIMENT_KEY_NOT_IN_DATAFILE,s,t))},getTrafficAllocation:function(e,t){var r=e.experimentKeyMap[t];if(n.isEmpty(r))throw new Error(o(u.INVALID_EXPERIMENT_KEY,s,t));return r.trafficAllocation},removeForcedVariation:function(e,t,r,n,i){if(!t)throw new Error(o(u.INVALID_USER_ID,s));if(!e.forcedVariationMap.hasOwnProperty(t))throw new Error(o(u.USER_NOT_IN_FORCED_VARIATION,s,t));delete e.forcedVariationMap[t][r],i.log(l.DEBUG,o(c.VARIATION_REMOVED_FOR_USER,s,n,t))},setInForcedVariationMap:function(e,t,r,n,i){e.forcedVariationMap.hasOwnProperty(t)?e.forcedVariationMap[t][r]=n:(e.forcedVariationMap[t]={},e.forcedVariationMap[t][r]=n),i.log(l.DEBUG,o(c.USER_MAPPED_TO_FORCED_VARIATION,s,n,r,t))},getForcedVariation:function(e,t,r,n){var i,a=e.forcedVariationMap[r];if(!a)return n.log(l.DEBUG,o(c.USER_HAS_NO_FORCED_VARIATION,s,r)),null;try{var f=this.getExperimentFromKey(e,t);if(!f.hasOwnProperty("id"))return n.log(l.ERROR,o(u.IMPROPERLY_FORMATTED_EXPERIMENT,s,t)),null;i=f.id}catch(e){return n.log(l.ERROR,e.message),null}var p=a[i];if(!p)return n.log(l.DEBUG,o(c.USER_HAS_NO_FORCED_VARIATION_FOR_EXPERIMENT,s,t,r)),null;var E=this.getVariationKeyFromId(e,p);return n.log(l.DEBUG,o(c.USER_HAS_FORCED_VARIATION,s,E,t,r)),E},setForcedVariation:function(e,t,r,n,i){if(null!=n&&!a.validate(n))return i.log(l.ERROR,o(u.INVALID_VARIATION_KEY,s)),!1;var c;try{var f=this.getExperimentFromKey(e,t);if(!f.hasOwnProperty("id"))return i.log(l.ERROR,o(u.IMPROPERLY_FORMATTED_EXPERIMENT,s,t)),!1;c=f.id}catch(e){return i.log(l.ERROR,e.message),!1}if(null==n)try{return this.removeForcedVariation(e,r,c,t,i),!0}catch(e){return i.log(l.ERROR,e.message),!1}var p=this.getVariationIdFromExperimentAndVariationKey(e,t,n);if(!p)return i.log(l.ERROR,o(u.NO_VARIATION_FOR_EXPERIMENT_KEY,s,n,t)),!1;try{return this.setInForcedVariationMap(e,r,c,p,i),!0}catch(e){return i.log(l.ERROR,e.message),!1}},getExperimentFromId:function(e,t,r){if(e.experimentIdMap.hasOwnProperty(t)){var n=e.experimentIdMap[t];if(n)return n}return r.log(l.ERROR,o(u.INVALID_EXPERIMENT_ID,s,t)),null},getFeatureFromKey:function(e,t,r){if(e.featureKeyMap.hasOwnProperty(t)){var n=e.featureKeyMap[t];if(n)return n}return r.log(l.ERROR,o(u.FEATURE_NOT_IN_DATAFILE,s,t)),null},getVariableForFeature:function(e,t,r,n){var i=e.featureKeyMap[t];if(!i)return n.log(l.ERROR,o(u.FEATURE_NOT_IN_DATAFILE,s,t)),null;var a=i.variableKeyMap[r];return a||(n.log(l.ERROR,o(u.VARIABLE_KEY_NOT_IN_DATAFILE,s,r,t)),null)},getVariableValueForVariation:function(e,t,r,n){if(!t||!r)return null;if(!e.variationVariableUsageMap.hasOwnProperty(r.id))return n.log(l.ERROR,o(u.VARIATION_ID_NOT_IN_DATAFILE_NO_EXPERIMENT,s,r.id)),null;var i=e.variationVariableUsageMap[r.id][t.id];return i?i.value:null},getTypeCastValue:function(e,t,r){var n;switch(t){case f.BOOLEAN:"true"!==e&&"false"!==e?(r.log(l.ERROR,o(u.UNABLE_TO_CAST_VALUE,s,e,t)),n=null):n="true"===e;break;case f.INTEGER:n=parseInt(e,10),isNaN(n)&&(r.log(l.ERROR,o(u.UNABLE_TO_CAST_VALUE,s,e,t)),n=null);break;case f.DOUBLE:n=parseFloat(e),isNaN(n)&&(r.log(l.ERROR,o(u.UNABLE_TO_CAST_VALUE,s,e,t)),n=null);break;default:n=e}return n},getAudiencesById:function(e){return e.audiencesById},eventWithKeyExists:function(e,t){return e.eventKeyMap.hasOwnProperty(t)},isFeatureExperiment:function(e,t){return e.experimentFeatureMap.hasOwnProperty(t)}}},function(e,t,r){var n=r(27),i=r(16),o=Object.prototype.hasOwnProperty;e.exports=function(e,t,r){var a=e[t];o.call(e,t)&&i(a,r)&&(void 0!==r||t in e)||n(e,t,r)}},function(e,t,r){var n=r(53);e.exports=function(e,t,r){"__proto__"==t&&n?n(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}},function(e,t){var r=9007199254740991;e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=r}},function(e,t){var r=9007199254740991,n=/^(?:0|[1-9]\d*)$/;e.exports=function(e,t){var i=typeof e;return!!(t=null==t?r:t)&&("number"==i||"symbol"!=i&&n.test(e))&&e>-1&&e%1==0&&e<t}},function(e,t,r){var n=r(106),i=r(5),o=Object.prototype,a=o.hasOwnProperty,s=o.propertyIsEnumerable,u=n(function(){return arguments}())?n:function(e){return i(e)&&a.call(e,"callee")&&!s.call(e,"callee")};e.exports=u},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,r){var n=r(108),i=r(33),o=r(34),a=o&&o.isTypedArray,s=a?i(a):n;e.exports=s},function(e,t){e.exports=function(e){return function(t){return e(t)}}},function(e,t,r){(function(e){var n=r(52),i=t&&!t.nodeType&&t,o=i&&"object"==typeof e&&e&&!e.nodeType&&e,a=o&&o.exports===i&&n.process,s=function(){try{var e=o&&o.require&&o.require("util").types;return e||a&&a.binding&&a.binding("util")}catch(e){}}();e.exports=s}).call(this,r(31)(e))},function(e,t,r){var n=r(57),i=r(111),o=r(8);e.exports=function(e){return o(e)?n(e,!0):i(e)}},function(e,t,r){var n=r(19),i=r(120),o=r(121),a=r(122),s=r(123),u=r(124);function c(e){var t=this.__data__=new n(e);this.size=t.size}c.prototype.clear=i,c.prototype.delete=o,c.prototype.get=a,c.prototype.has=s,c.prototype.set=u,e.exports=c},function(e,t,r){var n=r(6)(r(3),"Map");e.exports=n},function(e,t,r){var n=r(125),i=r(132),o=r(134),a=r(135),s=r(136);function u(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}u.prototype.clear=n,u.prototype.delete=i,u.prototype.get=o,u.prototype.has=a,u.prototype.set=s,e.exports=u},function(e,t,r){var n=r(61),i=r(62),o=Object.prototype.propertyIsEnumerable,a=Object.getOwnPropertySymbols,s=a?function(e){return null==e?[]:(e=Object(e),n(a(e),function(t){return o.call(e,t)}))}:i;e.exports=s},function(e,t,r){var n=r(68);e.exports=function(e){var t=new e.constructor(e.byteLength);return new n(t).set(new n(e)),t}},function(e,t,r){var n=r(168),i=r(181),o=r(17),a=r(1),s=r(191);e.exports=function(e){return"function"==typeof e?e:null==e?o:"object"==typeof e?a(e)?i(e[0],e[1]):n(e):s(e)}},function(e,t,r){var n=r(1),i=r(43),o=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,a=/^\w*$/;e.exports=function(e,t){if(n(e))return!1;var r=typeof e;return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!i(e))||a.test(e)||!o.test(e)||null!=t&&e in Object(t)}},function(e,t,r){var n=r(11),i=r(5),o="[object Symbol]";e.exports=function(e){return"symbol"==typeof e||i(e)&&n(e)==o}},function(e,t){e.exports=function(e,t){for(var r=-1,n=null==e?0:e.length,i=Array(n);++r<n;)i[r]=t(e[r],r,e);return i}},function(e,t,r){var n=r(0).sprintf,i=r(77),o=r(4),a=r(2).ERROR_MESSAGES;e.exports={validate:function(e){if("object"!=typeof e||Array.isArray(e)||null===e)throw new Error(n(a.INVALID_ATTRIBUTES,"ATTRIBUTES_VALIDATOR"));return i(e,function(e,t){if(void 0===e)throw new Error(n(a.UNDEFINED_ATTRIBUTE,"ATTRIBUTES_VALIDATOR",t))}),!0},isAttributeValid:function(e,t){return"string"==typeof e&&("string"==typeof t||"boolean"==typeof t||o.isNumber(t)&&o.isFinite(t))}}},function(e,t){var r;r=function(){return this}();try{r=r||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.prototype.handleError=function(e){},e}();t.NoopErrorHandler=n;var i=new n;t.setErrorHandler=function(e){i=e},t.getErrorHandler=function(){return i},t.resetErrorHandler=function(){i=new n}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.NOTSET=0]="NOTSET",e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARNING=3]="WARNING",e[e.ERROR=4]="ERROR"}(t.LogLevel||(t.LogLevel={}))},function(e,t,r){var n=r(87),i=r(88),o=i;o.v1=n,o.v4=i,e.exports=o},function(e,t){var r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(r){var n=new Uint8Array(16);e.exports=function(){return r(n),n}}else{var i=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),i[t]=e>>>((3&t)<<3)&255;return i}}},function(e,t){for(var r=[],n=0;n<256;++n)r[n]=(n+256).toString(16).substr(1);e.exports=function(e,t){var n=t||0,i=r;return[i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],"-",i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]],i[e[n++]]].join("")}},function(e,t,r){(function(t){var r="object"==typeof t&&t&&t.Object===Object&&t;e.exports=r}).call(this,r(46))},function(e,t,r){var n=r(6),i=function(){try{var e=n(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();e.exports=i},function(e,t,r){var n=r(11),i=r(7),o="[object AsyncFunction]",a="[object Function]",s="[object GeneratorFunction]",u="[object Proxy]";e.exports=function(e){if(!i(e))return!1;var t=n(e);return t==a||t==s||t==o||t==u}},function(e,t){var r=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return r.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},function(e,t,r){var n=r(97),i=r(104);e.exports=function(e){return n(function(t,r){var n=-1,o=r.length,a=o>1?r[o-1]:void 0,s=o>2?r[2]:void 0;for(a=e.length>3&&"function"==typeof a?(o--,a):void 0,s&&i(r[0],r[1],s)&&(a=o<3?void 0:a,o=1),t=Object(t);++n<o;){var u=r[n];u&&e(t,u,n,a)}return t})}},function(e,t,r){var n=r(105),i=r(30),o=r(1),a=r(18),s=r(29),u=r(32),c=Object.prototype.hasOwnProperty;e.exports=function(e,t){var r=o(e),l=!r&&i(e),f=!r&&!l&&a(e),p=!r&&!l&&!f&&u(e),E=r||l||f||p,_=E?n(e.length,String):[],v=_.length;for(var g in e)!t&&!c.call(e,g)||E&&("length"==g||f&&("offset"==g||"parent"==g)||p&&("buffer"==g||"byteLength"==g||"byteOffset"==g)||s(g,v))||_.push(g);return _}},function(e,t,r){var n=r(14),i=r(109),o=Object.prototype.hasOwnProperty;e.exports=function(e){if(!n(e))return i(e);var t=[];for(var r in Object(e))o.call(e,r)&&"constructor"!=r&&t.push(r);return t}},function(e,t){e.exports=function(e,t){return function(r){return e(t(r))}}},function(e,t){e.exports=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n&&!1!==t(e[r],r,e););return e}},function(e,t){e.exports=function(e,t){for(var r=-1,n=null==e?0:e.length,i=0,o=[];++r<n;){var a=e[r];t(a,r,e)&&(o[i++]=a)}return o}},function(e,t){e.exports=function(){return[]}},function(e,t,r){var n=r(64),i=r(65),o=r(39),a=r(62),s=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)n(t,o(e)),e=i(e);return t}:a;e.exports=s},function(e,t){e.exports=function(e,t){for(var r=-1,n=t.length,i=e.length;++r<n;)e[i+r]=t[r];return e}},function(e,t,r){var n=r(59)(Object.getPrototypeOf,Object);e.exports=n},function(e,t,r){var n=r(67),i=r(39),o=r(9);e.exports=function(e){return n(e,o,i)}},function(e,t,r){var n=r(64),i=r(1);e.exports=function(e,t,r){var o=t(e);return i(e)?o:n(o,r(e))}},function(e,t,r){var n=r(3).Uint8Array;e.exports=n},function(e,t,r){var n=r(165),i=r(9);e.exports=function(e,t){return e&&n(e,t,i)}},function(e,t,r){var n=r(170),i=r(5);e.exports=function e(t,r,o,a,s){return t===r||(null==t||null==r||!i(t)&&!i(r)?t!=t&&r!=r:n(t,r,o,a,e,s))}},function(e,t,r){var n=r(171),i=r(174),o=r(175),a=1,s=2;e.exports=function(e,t,r,u,c,l){var f=r&a,p=e.length,E=t.length;if(p!=E&&!(f&&E>p))return!1;var _=l.get(e);if(_&&l.get(t))return _==t;var v=-1,g=!0,d=r&s?new n:void 0;for(l.set(e,t),l.set(t,e);++v<p;){var h=e[v],I=t[v];if(u)var y=f?u(I,h,v,t,e,l):u(h,I,v,e,t,l);if(void 0!==y){if(y)continue;g=!1;break}if(d){if(!i(t,function(e,t){if(!o(d,t)&&(h===e||c(h,e,r,u,l)))return d.push(t)})){g=!1;break}}else if(h!==I&&!c(h,I,r,u,l)){g=!1;break}}return l.delete(e),l.delete(t),g}},function(e,t,r){var n=r(7);e.exports=function(e){return e==e&&!n(e)}},function(e,t){e.exports=function(e,t){return function(r){return null!=r&&r[e]===t&&(void 0!==t||e in Object(r))}}},function(e,t,r){var n=r(75),i=r(24);e.exports=function(e,t){for(var r=0,o=(t=n(t,e)).length;null!=e&&r<o;)e=e[i(t[r++])];return r&&r==o?e:void 0}},function(e,t,r){var n=r(1),i=r(42),o=r(183),a=r(186);e.exports=function(e,t){return n(e)?e:i(e,t)?[e]:o(a(e))}},function(e,t,r){var n=r(17);e.exports=function(e){return"function"==typeof e?e:n}},function(e,t,r){var n=r(69),i=r(76);e.exports=function(e,t){return e&&n(e,i(t))}},function(e,t,r){var n=r(0).sprintf,i=r(2).ERROR_MESSAGES,o="CONFIG_VALIDATOR",a=r(2).DATAFILE_VERSIONS,s=[a.V2,a.V3,a.V4];e.exports={validate:function(e){if(e.errorHandler&&"function"!=typeof e.errorHandler.handleError)throw new Error(n(i.INVALID_ERROR_HANDLER,o));if(e.eventDispatcher&&"function"!=typeof e.eventDispatcher.dispatchEvent)throw new Error(n(i.INVALID_EVENT_DISPATCHER,o));if(e.logger&&"function"!=typeof e.logger.log)throw new Error(n(i.INVALID_LOGGER,o));return!0},validateDatafile:function(e){if(!e)throw new Error(n(i.NO_DATAFILE_SPECIFIED,o));if("string"==typeof e||e instanceof String)try{e=JSON.parse(e)}catch(e){throw new Error(n(i.INVALID_DATAFILE_MALFORMED,o))}if(-1===s.indexOf(e.version))throw new Error(n(i.INVALID_DATAFILE_VERSION,o,e.version));return!0}}},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(80)),n(r(205)),n(r(81)),n(r(207))},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function a(e){try{u(n.next(e))}catch(e){o(e)}}function s(e){try{u(n.throw(e))}catch(e){o(e)}}function u(e){e.done?i(e.value):new r(function(t){t(e.value)}).then(a,s)}u((n=n.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(t,"__esModule",{value:!0});var o=r(204),a=r(10).getLogger("EventProcessor"),s=function(){function e(e){var t=e.dispatcher,r=e.transformers,n=void 0===r?[]:r,i=e.interceptors,a=void 0===i?[]:i,s=e.callbacks,u=void 0===s?[]:s,c=e.flushInterval,l=void 0===c?3e4:c,f=e.maxQueueSize,p=void 0===f?3e3:f,E=this;this.dispatcher=t,p=Math.max(1,p),this.queue=p>1?new o.DefaultEventQueue({flushInterval:l,maxQueueSize:p,sink:function(e){return E.drainQueue(e)}}):new o.SingleEventQueue({sink:function(e){return E.drainQueue(e)}}),this.transformers=n,this.interceptors=a,this.callbacks=u}return e.prototype.drainQueue=function(e){var t=this;a.debug("draining queue with %s events",e.length);var r=this.groupEvents(e).map(function(e){var r=t.formatEvents(e);return new Promise(function(n,i){t.dispatcher.dispatchEvent(r,function(r){e.forEach(function(e){t.callbacks.forEach(function(t){t({result:function(e){if(!e.statusCode)return!1;return e.statusCode>=200&&e.statusCode<300}(r),event:e})})}),n()})})});return Promise.all(r)},e.prototype.process=function(e,t){return n(this,void 0,void 0,function(){var r,n,o,s,u,c,l,f,p;return i(this,function(i){switch(i.label){case 0:r=0,n=this.transformers,i.label=1;case 1:if(!(r<n.length))return[3,6];o=n[r],i.label=2;case 2:return i.trys.push([2,4,,5]),[4,o(e,t)];case 3:return i.sent(),[3,5];case 4:return s=i.sent(),a.error("eventTransformer threw error",s.message,s),[3,5];case 5:return r++,[3,1];case 6:Object.freeze(e),u=0,c=this.interceptors,i.label=7;case 7:if(!(u<c.length))return[3,13];l=c[u],f=void 0,i.label=8;case 8:return i.trys.push([8,10,,11]),[4,l(e,t)];case 9:return f=i.sent(),[3,11];case 10:return p=i.sent(),a.error("eventInterceptor threw error",p.message,p),[3,11];case 11:if(!1===f)return[2];i.label=12;case 12:return u++,[3,7];case 13:return this.queue.enqueue(e),[2]}})})},e.prototype.stop=function(){try{return this.queue.stop()}catch(e){a.error('Error stopping EventProcessor: "%s"',e.message,e)}return Promise.resolve()},e.prototype.start=function(){this.queue.start()},e.DEFAULT_FLUSH_INTERVAL=3e4,e}();t.AbstractEventProcessor=s},function(e,t,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i="campaign_activated",o="custom",a="$opt_bot_filtering";function s(e){var t=n({},e.tags);delete t.revenue,delete t.value;var r={entity_id:e.event.id,key:e.event.key,timestamp:e.timestamp,uuid:e.uuid};return e.tags&&(r.tags=e.tags),null!=e.value&&(r.value=e.value),null!=e.revenue&&(r.revenue=e.revenue),{events:[r]}}function u(e){var t=e.layer,r=e.experiment,n=e.variation,o=t?t.id:null;return{decisions:[{campaign_id:o,experiment_id:r?r.id:null,variation_id:n?n.id:null}],events:[{entity_id:o,timestamp:e.timestamp,key:i,uuid:e.uuid}]}}function c(e){var t={snapshots:[],visitor_id:e.user.id,attributes:[]};return e.user.attributes.forEach(function(e){t.attributes.push({entity_id:e.entityId,key:e.key,type:"custom",value:e.value})}),"boolean"==typeof e.context.botFiltering&&t.attributes.push({entity_id:a,key:a,type:o,value:e.context.botFiltering}),t}t.makeBatchedEventV1=function(e){var t=[],r=e[0];return e.forEach(function(e){if("conversion"===e.type||"impression"===e.type){var r=c(e);"impression"===e.type?r.snapshots.push(u(e)):"conversion"===e.type&&r.snapshots.push(s(e)),t.push(r)}}),{client_name:r.context.clientName,client_version:r.context.clientVersion,account_id:r.context.accountId,project_id:r.context.projectId,revision:r.context.revision,anonymize_ip:r.context.anonymizeIP,enrich_decisions:!0,visitors:t}},t.buildImpressionEventV1=function(e){var t=c(e);return t.snapshots.push(u(e)),{client_name:e.context.clientName,client_version:e.context.clientVersion,account_id:e.context.accountId,project_id:e.context.projectId,revision:e.context.revision,anonymize_ip:e.context.anonymizeIP,enrich_decisions:!0,visitors:[t]}},t.buildConversionEventV1=function(e){var t=c(e);return t.snapshots.push(s(e)),{client_name:e.context.clientName,client_version:e.context.clientVersion,account_id:e.context.accountId,project_id:e.context.projectId,revision:e.context.revision,anonymize_ip:e.context.anonymizeIP,enrich_decisions:!0,visitors:[t]}}},function(e,t){e.exports={validate:function(e){return"string"==typeof e&&""!==e}}},function(e,t,r){var n=r(2),i=r(0).sprintf,o=n.LOG_LEVEL,a=n.LOG_MESSAGES,s=n.RESERVED_EVENT_KEYWORDS.REVENUE,u=n.RESERVED_EVENT_KEYWORDS.VALUE;e.exports={getRevenueValue:function(e,t){if(e&&e.hasOwnProperty(s)){var r=e[s],n=parseInt(r,10);return isNaN(n)?(t.log(o.INFO,i(a.FAILED_TO_PARSE_REVENUE,"EVENT_TAG_UTILS",r)),null):(t.log(o.INFO,i(a.PARSED_REVENUE_VALUE,"EVENT_TAG_UTILS",n)),n)}return null},getEventValue:function(e,t){if(e&&e.hasOwnProperty(u)){var r=e[u],n=parseFloat(r);return isNaN(n)?(t.log(o.INFO,i(a.FAILED_TO_PARSE_VALUE,"EVENT_TAG_UTILS",r)),null):(t.log(o.INFO,i(a.PARSED_NUMERIC_VALUE,"EVENT_TAG_UTILS",n)),n)}return null}}},function(e,t,r){r(85);var n=r(10),i=r(4),o=r(78),a=r(202),s=r(203),u=r(2),c=r(79),l=r(208),f=r(209),p=n.getLogger();n.setLogHandler(l.createLogger()),n.setLogLevel(n.LogLevel.INFO);var E=!1;e.exports={logging:l,errorHandler:a,eventDispatcher:s,enums:u,setLogger:n.setLogHandler,setLogLevel:n.setLogLevel,createInstance:function(e){try{(e=e||{}).errorHandler&&n.setErrorHandler(e.errorHandler),e.logger&&(n.setLogHandler(e.logger),n.setLogLevel(n.LogLevel.NOTSET)),void 0!==e.logLevel&&n.setLogLevel(e.logLevel);try{o.validate(e),e.isValidInstance=!0}catch(t){p.error(t),e.isValidInstance=!1}null==e.skipJSONValidation&&(e.skipJSONValidation=!0);var t=new c.LocalStoragePendingEventsDispatcher({eventDispatcher:e.eventDispatcher||s});return E||(t.sendPendingEvents(),E=!0),e=i.assignIn({},e,{eventDispatcher:t,clientEngine:u.JAVASCRIPT_CLIENT_ENGINE,logger:p,errorHandler:n.getErrorHandler()}),new f(e)}catch(e){return p.error(e),null}},__internalResetRetryState:function(){E=!1}}},function(e,t,r){(function(e){!function(e,t){t()}(0,function(){"use strict";function t(e){var t=this.constructor;return this.then(function(r){return t.resolve(e()).then(function(){return r})},function(r){return t.resolve(e()).then(function(){return t.reject(r)})})}var r=setTimeout;function n(){}function i(e){if(!(this instanceof i))throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],c(e,this)}function o(e,t){for(;3===e._state;)e=e._value;0!==e._state?(e._handled=!0,i._immediateFn(function(){var r=1===e._state?t.onFulfilled:t.onRejected;if(null!==r){var n;try{n=r(e._value)}catch(e){return void s(t.promise,e)}a(t.promise,n)}else(1===e._state?a:s)(t.promise,e._value)})):e._deferreds.push(t)}function a(e,t){try{if(t===e)throw new TypeError("A promise cannot be resolved with itself.");if(t&&("object"==typeof t||"function"==typeof t)){var r=t.then;if(t instanceof i)return e._state=3,e._value=t,void u(e);if("function"==typeof r)return void c(function(e,t){return function(){e.apply(t,arguments)}}(r,t),e)}e._state=1,e._value=t,u(e)}catch(t){s(e,t)}}function s(e,t){e._state=2,e._value=t,u(e)}function u(e){2===e._state&&0===e._deferreds.length&&i._immediateFn(function(){e._handled||i._unhandledRejectionFn(e._value)});for(var t=0,r=e._deferreds.length;t<r;t++)o(e,e._deferreds[t]);e._deferreds=null}function c(e,t){var r=!1;try{e(function(e){r||(r=!0,a(t,e))},function(e){r||(r=!0,s(t,e))})}catch(e){if(r)return;r=!0,s(t,e)}}i.prototype.catch=function(e){return this.then(null,e)},i.prototype.then=function(e,t){var r=new this.constructor(n);return o(this,new function(e,t,r){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.promise=r}(e,t,r)),r},i.prototype.finally=t,i.all=function(e){return new i(function(t,r){if(!e||void 0===e.length)throw new TypeError("Promise.all accepts an array");var n=Array.prototype.slice.call(e);if(0===n.length)return t([]);var i=n.length;function o(e,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var s=a.then;if("function"==typeof s)return void s.call(a,function(t){o(e,t)},r)}n[e]=a,0==--i&&t(n)}catch(e){r(e)}}for(var a=0;a<n.length;a++)o(a,n[a])})},i.resolve=function(e){return e&&"object"==typeof e&&e.constructor===i?e:new i(function(t){t(e)})},i.reject=function(e){return new i(function(t,r){r(e)})},i.race=function(e){return new i(function(t,r){for(var n=0,i=e.length;n<i;n++)e[n].then(t,r)})},i._immediateFn="function"==typeof setImmediate&&function(e){setImmediate(e)}||function(e){r(e,0)},i._unhandledRejectionFn=function(e){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",e)};var l=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==e)return e;throw new Error("unable to locate global object")}();"Promise"in l?l.Promise.prototype.finally||(l.Promise.prototype.finally=t):l.Promise=i})}).call(this,r(46))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(47),i=r(0),o=r(48),a={NOTSET:0,DEBUG:1,INFO:2,WARNING:3,ERROR:4};function s(e){return"string"!=typeof e?e:("WARN"===(e=e.toUpperCase())&&(e="WARNING"),a[e]?a[e]:e)}var u=function(){function e(){this.defaultLoggerFacade=new p,this.loggers={}}return e.prototype.getLogger=function(e){return e?(this.loggers[e]||(this.loggers[e]=new p({messagePrefix:e})),this.loggers[e]):this.defaultLoggerFacade},e}(),c=function(){function e(e){void 0===e&&(e={}),this.logLevel=o.LogLevel.NOTSET,void 0!==e.logLevel&&i.isValidEnum(o.LogLevel,e.logLevel)&&this.setLogLevel(e.logLevel),this.logToConsole=void 0===e.logToConsole||!!e.logToConsole,this.prefix=void 0!==e.prefix?e.prefix:"[OPTIMIZELY]"}return e.prototype.log=function(e,t){if(this.shouldLog(e)&&this.logToConsole){var r=this.prefix+" - "+this.getLogLevelName(e)+" "+this.getTime()+" "+t;this.consoleLog(e,[r])}},e.prototype.setLogLevel=function(e){e=s(e),i.isValidEnum(o.LogLevel,e)&&void 0!==e?this.logLevel=e:this.logLevel=o.LogLevel.ERROR},e.prototype.getTime=function(){return(new Date).toISOString()},e.prototype.shouldLog=function(e){return e>=this.logLevel},e.prototype.getLogLevelName=function(e){switch(e){case o.LogLevel.DEBUG:return"DEBUG";case o.LogLevel.INFO:return"INFO ";case o.LogLevel.WARNING:return"WARN ";case o.LogLevel.ERROR:return"ERROR";default:return"NOTSET"}},e.prototype.consoleLog=function(e,t){switch(e){case o.LogLevel.DEBUG:console.log.apply(console,t);break;case o.LogLevel.INFO:console.info.apply(console,t);break;case o.LogLevel.WARNING:console.warn.apply(console,t);break;case o.LogLevel.ERROR:console.error.apply(console,t);break;default:console.log.apply(console,t)}},e}();t.ConsoleLogHandler=c;var l=o.LogLevel.NOTSET,f=null,p=function(){function e(e){void 0===e&&(e={}),this.messagePrefix="",e.messagePrefix&&(this.messagePrefix=e.messagePrefix)}return e.prototype.log=function(e,t){this.internalLog(s(e),{message:t,splat:[]})},e.prototype.info=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];this.namedLog(o.LogLevel.INFO,e,t)},e.prototype.debug=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];this.namedLog(o.LogLevel.DEBUG,e,t)},e.prototype.warn=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];this.namedLog(o.LogLevel.WARNING,e,t)},e.prototype.error=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];this.namedLog(o.LogLevel.ERROR,e,t)},e.prototype.format=function(e){return(this.messagePrefix?this.messagePrefix+": ":"")+i.sprintf.apply(void 0,[e.message].concat(e.splat))},e.prototype.internalLog=function(e,t){f&&(e<l||(f.log(e,this.format(t)),t.error&&t.error instanceof Error&&n.getErrorHandler().handleError(t.error)))},e.prototype.namedLog=function(e,t,r){var n;if(t instanceof Error)return t=(n=t).message,void this.internalLog(e,{error:n,message:t,splat:r});if(0!==r.length){var i=r[r.length-1];i instanceof Error&&(n=i,r.splice(-1)),this.internalLog(e,{message:t,error:n,splat:r})}else this.internalLog(e,{message:t,splat:r})},e}(),E=new u;t.getLogger=function(e){return E.getLogger(e)},t.setLogHandler=function(e){f=e},t.setLogLevel=function(e){e=s(e),l=i.isValidEnum(o.LogLevel,e)&&void 0!==e?e:o.LogLevel.ERROR},t.getLogLevel=function(){return l},t.resetLogger=function(){E=new u,l=o.LogLevel.NOTSET}},function(e,t,r){var n,i,o=r(50),a=r(51),s=0,u=0;e.exports=function(e,t,r){var c=t&&r||0,l=t||[],f=(e=e||{}).node||n,p=void 0!==e.clockseq?e.clockseq:i;if(null==f||null==p){var E=o();null==f&&(f=n=[1|E[0],E[1],E[2],E[3],E[4],E[5]]),null==p&&(p=i=16383&(E[6]<<8|E[7]))}var _=void 0!==e.msecs?e.msecs:(new Date).getTime(),v=void 0!==e.nsecs?e.nsecs:u+1,g=_-s+(v-u)/1e4;if(g<0&&void 0===e.clockseq&&(p=p+1&16383),(g<0||_>s)&&void 0===e.nsecs&&(v=0),v>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");s=_,u=v,i=p;var d=(1e4*(268435455&(_+=122192928e5))+v)%4294967296;l[c++]=d>>>24&255,l[c++]=d>>>16&255,l[c++]=d>>>8&255,l[c++]=255&d;var h=_/4294967296*1e4&268435455;l[c++]=h>>>8&255,l[c++]=255&h,l[c++]=h>>>24&15|16,l[c++]=h>>>16&255,l[c++]=p>>>8|128,l[c++]=255&p;for(var I=0;I<6;++I)l[c+I]=f[I];return t||a(l)}},function(e,t,r){var n=r(50),i=r(51);e.exports=function(e,t,r){var o=t&&r||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var a=(e=e||{}).random||(e.rng||n)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t)for(var s=0;s<16;++s)t[o+s]=a[s];return t||i(a)}},function(e,t,r){var n=r(3).isFinite;e.exports=function(e){return"number"==typeof e&&n(e)}},function(e,t,r){var n=r(26),i=r(12),o=r(56),a=r(8),s=r(14),u=r(9),c=Object.prototype.hasOwnProperty,l=o(function(e,t){if(s(t)||a(t))i(t,u(t),e);else for(var r in t)c.call(t,r)&&n(e,r,t[r])});e.exports=l},function(e,t,r){var n=r(54),i=r(94),o=r(7),a=r(55),s=/^\[object .+?Constructor\]$/,u=Function.prototype,c=Object.prototype,l=u.toString,f=c.hasOwnProperty,p=RegExp("^"+l.call(f).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!o(e)||i(e))&&(n(e)?p:s).test(a(e))}},function(e,t,r){var n=r(13),i=Object.prototype,o=i.hasOwnProperty,a=i.toString,s=n?n.toStringTag:void 0;e.exports=function(e){var t=o.call(e,s),r=e[s];try{e[s]=void 0;var n=!0}catch(e){}var i=a.call(e);return n&&(t?e[s]=r:delete e[s]),i}},function(e,t){var r=Object.prototype.toString;e.exports=function(e){return r.call(e)}},function(e,t,r){var n=r(95),i=function(){var e=/[^.]+$/.exec(n&&n.keys&&n.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();e.exports=function(e){return!!i&&i in e}},function(e,t,r){var n=r(3)["__core-js_shared__"];e.exports=n},function(e,t){e.exports=function(e,t){return null==e?void 0:e[t]}},function(e,t,r){var n=r(17),i=r(98),o=r(100);e.exports=function(e,t){return o(i(e,t,n),e+"")}},function(e,t,r){var n=r(99),i=Math.max;e.exports=function(e,t,r){return t=i(void 0===t?e.length-1:t,0),function(){for(var o=arguments,a=-1,s=i(o.length-t,0),u=Array(s);++a<s;)u[a]=o[t+a];a=-1;for(var c=Array(t+1);++a<t;)c[a]=o[a];return c[t]=r(u),n(e,this,c)}}},function(e,t){e.exports=function(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}},function(e,t,r){var n=r(101),i=r(103)(n);e.exports=i},function(e,t,r){var n=r(102),i=r(53),o=r(17),a=i?function(e,t){return i(e,"toString",{configurable:!0,enumerable:!1,value:n(t),writable:!0})}:o;e.exports=a},function(e,t){e.exports=function(e){return function(){return e}}},function(e,t){var r=800,n=16,i=Date.now;e.exports=function(e){var t=0,o=0;return function(){var a=i(),s=n-(a-o);if(o=a,s>0){if(++t>=r)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}},function(e,t,r){var n=r(16),i=r(8),o=r(29),a=r(7);e.exports=function(e,t,r){if(!a(r))return!1;var s=typeof t;return!!("number"==s?i(r)&&o(t,r.length):"string"==s&&t in r)&&n(r[t],e)}},function(e,t){e.exports=function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}},function(e,t,r){var n=r(11),i=r(5),o="[object Arguments]";e.exports=function(e){return i(e)&&n(e)==o}},function(e,t){e.exports=function(){return!1}},function(e,t,r){var n=r(11),i=r(28),o=r(5),a={};a["[object Float32Array]"]=a["[object Float64Array]"]=a["[object Int8Array]"]=a["[object Int16Array]"]=a["[object Int32Array]"]=a["[object Uint8Array]"]=a["[object Uint8ClampedArray]"]=a["[object Uint16Array]"]=a["[object Uint32Array]"]=!0,a["[object Arguments]"]=a["[object Array]"]=a["[object ArrayBuffer]"]=a["[object Boolean]"]=a["[object DataView]"]=a["[object Date]"]=a["[object Error]"]=a["[object Function]"]=a["[object Map]"]=a["[object Number]"]=a["[object Object]"]=a["[object RegExp]"]=a["[object Set]"]=a["[object String]"]=a["[object WeakMap]"]=!1,e.exports=function(e){return o(e)&&i(e.length)&&!!a[n(e)]}},function(e,t,r){var n=r(59)(Object.keys,Object);e.exports=n},function(e,t,r){var n=r(12),i=r(56),o=r(35),a=i(function(e,t){n(t,o(t),e)});e.exports=a},function(e,t,r){var n=r(7),i=r(14),o=r(112),a=Object.prototype.hasOwnProperty;e.exports=function(e){if(!n(e))return o(e);var t=i(e),r=[];for(var s in e)("constructor"!=s||!t&&a.call(e,s))&&r.push(s);return r}},function(e,t){e.exports=function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}},function(e,t,r){var n=r(114),i=1,o=4;e.exports=function(e){return n(e,i|o)}},function(e,t,r){var n=r(36),i=r(60),o=r(26),a=r(137),s=r(138),u=r(139),c=r(140),l=r(141),f=r(142),p=r(66),E=r(143),_=r(15),v=r(148),g=r(149),d=r(154),h=r(1),I=r(18),y=r(156),O=r(7),R=r(158),N=r(9),T=1,A=2,m=4,b="[object Arguments]",S="[object Function]",L="[object GeneratorFunction]",x="[object Object]",U={};U[b]=U["[object Array]"]=U["[object ArrayBuffer]"]=U["[object DataView]"]=U["[object Boolean]"]=U["[object Date]"]=U["[object Float32Array]"]=U["[object Float64Array]"]=U["[object Int8Array]"]=U["[object Int16Array]"]=U["[object Int32Array]"]=U["[object Map]"]=U["[object Number]"]=U[x]=U["[object RegExp]"]=U["[object Set]"]=U["[object String]"]=U["[object Symbol]"]=U["[object Uint8Array]"]=U["[object Uint8ClampedArray]"]=U["[object Uint16Array]"]=U["[object Uint32Array]"]=!0,U["[object Error]"]=U[S]=U["[object WeakMap]"]=!1,e.exports=function e(t,r,V,D,P,F){var j,C=r&T,w=r&A,M=r&m;if(V&&(j=P?V(t,D,P,F):V(t)),void 0!==j)return j;if(!O(t))return t;var k=h(t);if(k){if(j=v(t),!C)return c(t,j)}else{var B=_(t),G=B==S||B==L;if(I(t))return u(t,C);if(B==x||B==b||G&&!P){if(j=w||G?{}:d(t),!C)return w?f(t,s(j,t)):l(t,a(j,t))}else{if(!U[B])return P?t:{};j=g(t,B,C)}}F||(F=new n);var K=F.get(t);if(K)return K;if(F.set(t,j),R(t))return t.forEach(function(n){j.add(e(n,r,V,n,t,F))}),j;if(y(t))return t.forEach(function(n,i){j.set(i,e(n,r,V,i,t,F))}),j;var H=M?w?E:p:w?keysIn:N,Y=k?void 0:H(t);return i(Y||t,function(n,i){Y&&(n=t[i=n]),o(j,i,e(n,r,V,i,t,F))}),j}},function(e,t){e.exports=function(){this.__data__=[],this.size=0}},function(e,t,r){var n=r(20),i=Array.prototype.splice;e.exports=function(e){var t=this.__data__,r=n(t,e);return!(r<0||(r==t.length-1?t.pop():i.call(t,r,1),--this.size,0))}},function(e,t,r){var n=r(20);e.exports=function(e){var t=this.__data__,r=n(t,e);return r<0?void 0:t[r][1]}},function(e,t,r){var n=r(20);e.exports=function(e){return n(this.__data__,e)>-1}},function(e,t,r){var n=r(20);e.exports=function(e,t){var r=this.__data__,i=n(r,e);return i<0?(++this.size,r.push([e,t])):r[i][1]=t,this}},function(e,t,r){var n=r(19);e.exports=function(){this.__data__=new n,this.size=0}},function(e,t){e.exports=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}},function(e,t){e.exports=function(e){return this.__data__.get(e)}},function(e,t){e.exports=function(e){return this.__data__.has(e)}},function(e,t,r){var n=r(19),i=r(37),o=r(38),a=200;e.exports=function(e,t){var r=this.__data__;if(r instanceof n){var s=r.__data__;if(!i||s.length<a-1)return s.push([e,t]),this.size=++r.size,this;r=this.__data__=new o(s)}return r.set(e,t),this.size=r.size,this}},function(e,t,r){var n=r(126),i=r(19),o=r(37);e.exports=function(){this.size=0,this.__data__={hash:new n,map:new(o||i),string:new n}}},function(e,t,r){var n=r(127),i=r(128),o=r(129),a=r(130),s=r(131);function u(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}u.prototype.clear=n,u.prototype.delete=i,u.prototype.get=o,u.prototype.has=a,u.prototype.set=s,e.exports=u},function(e,t,r){var n=r(21);e.exports=function(){this.__data__=n?n(null):{},this.size=0}},function(e,t){e.exports=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}},function(e,t,r){var n=r(21),i="__lodash_hash_undefined__",o=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;if(n){var r=t[e];return r===i?void 0:r}return o.call(t,e)?t[e]:void 0}},function(e,t,r){var n=r(21),i=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;return n?void 0!==t[e]:i.call(t,e)}},function(e,t,r){var n=r(21),i="__lodash_hash_undefined__";e.exports=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=n&&void 0===t?i:t,this}},function(e,t,r){var n=r(22);e.exports=function(e){var t=n(this,e).delete(e);return this.size-=t?1:0,t}},function(e,t){e.exports=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}},function(e,t,r){var n=r(22);e.exports=function(e){return n(this,e).get(e)}},function(e,t,r){var n=r(22);e.exports=function(e){return n(this,e).has(e)}},function(e,t,r){var n=r(22);e.exports=function(e,t){var r=n(this,e),i=r.size;return r.set(e,t),this.size+=r.size==i?0:1,this}},function(e,t,r){var n=r(12),i=r(9);e.exports=function(e,t){return e&&n(t,i(t),e)}},function(e,t,r){var n=r(12),i=r(35);e.exports=function(e,t){return e&&n(t,i(t),e)}},function(e,t,r){(function(e){var n=r(3),i=t&&!t.nodeType&&t,o=i&&"object"==typeof e&&e&&!e.nodeType&&e,a=o&&o.exports===i?n.Buffer:void 0,s=a?a.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var r=e.length,n=s?s(r):new e.constructor(r);return e.copy(n),n}}).call(this,r(31)(e))},function(e,t){e.exports=function(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t}},function(e,t,r){var n=r(12),i=r(39);e.exports=function(e,t){return n(e,i(e),t)}},function(e,t,r){var n=r(12),i=r(63);e.exports=function(e,t){return n(e,i(e),t)}},function(e,t,r){var n=r(67),i=r(63),o=r(35);e.exports=function(e){return n(e,o,i)}},function(e,t,r){var n=r(6)(r(3),"DataView");e.exports=n},function(e,t,r){var n=r(6)(r(3),"Promise");e.exports=n},function(e,t,r){var n=r(6)(r(3),"Set");e.exports=n},function(e,t,r){var n=r(6)(r(3),"WeakMap");e.exports=n},function(e,t){var r=Object.prototype.hasOwnProperty;e.exports=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&r.call(e,"index")&&(n.index=e.index,n.input=e.input),n}},function(e,t,r){var n=r(40),i=r(150),o=r(151),a=r(152),s=r(153),u="[object Boolean]",c="[object Date]",l="[object Map]",f="[object Number]",p="[object RegExp]",E="[object Set]",_="[object String]",v="[object Symbol]",g="[object ArrayBuffer]",d="[object DataView]",h="[object Float32Array]",I="[object Float64Array]",y="[object Int8Array]",O="[object Int16Array]",R="[object Int32Array]",N="[object Uint8Array]",T="[object Uint8ClampedArray]",A="[object Uint16Array]",m="[object Uint32Array]";e.exports=function(e,t,r){var b=e.constructor;switch(t){case g:return n(e);case u:case c:return new b(+e);case d:return i(e,r);case h:case I:case y:case O:case R:case N:case T:case A:case m:return s(e,r);case l:return new b;case f:case _:return new b(e);case p:return o(e);case E:return new b;case v:return a(e)}}},function(e,t,r){var n=r(40);e.exports=function(e,t){var r=t?n(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.byteLength)}},function(e,t){var r=/\w*$/;e.exports=function(e){var t=new e.constructor(e.source,r.exec(e));return t.lastIndex=e.lastIndex,t}},function(e,t,r){var n=r(13),i=n?n.prototype:void 0,o=i?i.valueOf:void 0;e.exports=function(e){return o?Object(o.call(e)):{}}},function(e,t,r){var n=r(40);e.exports=function(e,t){var r=t?n(e.buffer):e.buffer;return new e.constructor(r,e.byteOffset,e.length)}},function(e,t,r){var n=r(155),i=r(65),o=r(14);e.exports=function(e){return"function"!=typeof e.constructor||o(e)?{}:n(i(e))}},function(e,t,r){var n=r(7),i=Object.create,o=function(){function e(){}return function(t){if(!n(t))return{};if(i)return i(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}();e.exports=o},function(e,t,r){var n=r(157),i=r(33),o=r(34),a=o&&o.isMap,s=a?i(a):n;e.exports=s},function(e,t,r){var n=r(15),i=r(5),o="[object Map]";e.exports=function(e){return i(e)&&n(e)==o}},function(e,t,r){var n=r(159),i=r(33),o=r(34),a=o&&o.isSet,s=a?i(a):n;e.exports=s},function(e,t,r){var n=r(15),i=r(5),o="[object Set]";e.exports=function(e){return i(e)&&n(e)==o}},function(e,t,r){var n=r(58),i=r(15),o=r(30),a=r(1),s=r(8),u=r(18),c=r(14),l=r(32),f="[object Map]",p="[object Set]",E=Object.prototype.hasOwnProperty;e.exports=function(e){if(null==e)return!0;if(s(e)&&(a(e)||"string"==typeof e||"function"==typeof e.splice||u(e)||l(e)||o(e)))return!e.length;var t=i(e);if(t==f||t==p)return!e.size;if(c(e))return!n(e).length;for(var r in e)if(E.call(e,r))return!1;return!0}},function(e,t,r){var n=r(27),i=r(162)(function(e,t,r){n(e,r,t)});e.exports=i},function(e,t,r){var n=r(163),i=r(164),o=r(41),a=r(1);e.exports=function(e,t){return function(r,s){var u=a(r)?n:i,c=t?t():{};return u(r,e,o(s,2),c)}}},function(e,t){e.exports=function(e,t,r,n){for(var i=-1,o=null==e?0:e.length;++i<o;){var a=e[i];t(n,a,r(a),e)}return n}},function(e,t,r){var n=r(23);e.exports=function(e,t,r,i){return n(e,function(e,n,o){t(i,e,r(e),o)}),i}},function(e,t,r){var n=r(166)();e.exports=n},function(e,t){e.exports=function(e){return function(t,r,n){for(var i=-1,o=Object(t),a=n(t),s=a.length;s--;){var u=a[e?s:++i];if(!1===r(o[u],u,o))break}return t}}},function(e,t,r){var n=r(8);e.exports=function(e,t){return function(r,i){if(null==r)return r;if(!n(r))return e(r,i);for(var o=r.length,a=t?o:-1,s=Object(r);(t?a--:++a<o)&&!1!==i(s[a],a,s););return r}}},function(e,t,r){var n=r(169),i=r(180),o=r(73);e.exports=function(e){var t=i(e);return 1==t.length&&t[0][2]?o(t[0][0],t[0][1]):function(r){return r===e||n(r,e,t)}}},function(e,t,r){var n=r(36),i=r(70),o=1,a=2;e.exports=function(e,t,r,s){var u=r.length,c=u,l=!s;if(null==e)return!c;for(e=Object(e);u--;){var f=r[u];if(l&&f[2]?f[1]!==e[f[0]]:!(f[0]in e))return!1}for(;++u<c;){var p=(f=r[u])[0],E=e[p],_=f[1];if(l&&f[2]){if(void 0===E&&!(p in e))return!1}else{var v=new n;if(s)var g=s(E,_,p,e,t,v);if(!(void 0===g?i(_,E,o|a,s,v):g))return!1}}return!0}},function(e,t,r){var n=r(36),i=r(71),o=r(176),a=r(179),s=r(15),u=r(1),c=r(18),l=r(32),f=1,p="[object Arguments]",E="[object Array]",_="[object Object]",v=Object.prototype.hasOwnProperty;e.exports=function(e,t,r,g,d,h){var I=u(e),y=u(t),O=I?E:s(e),R=y?E:s(t),N=(O=O==p?_:O)==_,T=(R=R==p?_:R)==_,A=O==R;if(A&&c(e)){if(!c(t))return!1;I=!0,N=!1}if(A&&!N)return h||(h=new n),I||l(e)?i(e,t,r,g,d,h):o(e,t,O,r,g,d,h);if(!(r&f)){var m=N&&v.call(e,"__wrapped__"),b=T&&v.call(t,"__wrapped__");if(m||b){var S=m?e.value():e,L=b?t.value():t;return h||(h=new n),d(S,L,r,g,h)}}return!!A&&(h||(h=new n),a(e,t,r,g,d,h))}},function(e,t,r){var n=r(38),i=r(172),o=r(173);function a(e){var t=-1,r=null==e?0:e.length;for(this.__data__=new n;++t<r;)this.add(e[t])}a.prototype.add=a.prototype.push=i,a.prototype.has=o,e.exports=a},function(e,t){var r="__lodash_hash_undefined__";e.exports=function(e){return this.__data__.set(e,r),this}},function(e,t){e.exports=function(e){return this.__data__.has(e)}},function(e,t){e.exports=function(e,t){for(var r=-1,n=null==e?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}},function(e,t){e.exports=function(e,t){return e.has(t)}},function(e,t,r){var n=r(13),i=r(68),o=r(16),a=r(71),s=r(177),u=r(178),c=1,l=2,f="[object Boolean]",p="[object Date]",E="[object Error]",_="[object Map]",v="[object Number]",g="[object RegExp]",d="[object Set]",h="[object String]",I="[object Symbol]",y="[object ArrayBuffer]",O="[object DataView]",R=n?n.prototype:void 0,N=R?R.valueOf:void 0;e.exports=function(e,t,r,n,R,T,A){switch(r){case O:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case y:return!(e.byteLength!=t.byteLength||!T(new i(e),new i(t)));case f:case p:case v:return o(+e,+t);case E:return e.name==t.name&&e.message==t.message;case g:case h:return e==t+"";case _:var m=s;case d:var b=n&c;if(m||(m=u),e.size!=t.size&&!b)return!1;var S=A.get(e);if(S)return S==t;n|=l,A.set(e,t);var L=a(m(e),m(t),n,R,T,A);return A.delete(e),L;case I:if(N)return N.call(e)==N.call(t)}return!1}},function(e,t){e.exports=function(e){var t=-1,r=Array(e.size);return e.forEach(function(e,n){r[++t]=[n,e]}),r}},function(e,t){e.exports=function(e){var t=-1,r=Array(e.size);return e.forEach(function(e){r[++t]=e}),r}},function(e,t,r){var n=r(66),i=1,o=Object.prototype.hasOwnProperty;e.exports=function(e,t,r,a,s,u){var c=r&i,l=n(e),f=l.length;if(f!=n(t).length&&!c)return!1;for(var p=f;p--;){var E=l[p];if(!(c?E in t:o.call(t,E)))return!1}var _=u.get(e);if(_&&u.get(t))return _==t;var v=!0;u.set(e,t),u.set(t,e);for(var g=c;++p<f;){var d=e[E=l[p]],h=t[E];if(a)var I=c?a(h,d,E,t,e,u):a(d,h,E,e,t,u);if(!(void 0===I?d===h||s(d,h,r,a,u):I)){v=!1;break}g||(g="constructor"==E)}if(v&&!g){var y=e.constructor,O=t.constructor;y!=O&&"constructor"in e&&"constructor"in t&&!("function"==typeof y&&y instanceof y&&"function"==typeof O&&O instanceof O)&&(v=!1)}return u.delete(e),u.delete(t),v}},function(e,t,r){var n=r(72),i=r(9);e.exports=function(e){for(var t=i(e),r=t.length;r--;){var o=t[r],a=e[o];t[r]=[o,a,n(a)]}return t}},function(e,t,r){var n=r(70),i=r(182),o=r(188),a=r(42),s=r(72),u=r(73),c=r(24),l=1,f=2;e.exports=function(e,t){return a(e)&&s(t)?u(c(e),t):function(r){var a=i(r,e);return void 0===a&&a===t?o(r,e):n(t,a,l|f)}}},function(e,t,r){var n=r(74);e.exports=function(e,t,r){var i=null==e?void 0:n(e,t);return void 0===i?r:i}},function(e,t,r){var n=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,i=/\\(\\)?/g,o=r(184)(function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(n,function(e,r,n,o){t.push(n?o.replace(i,"$1"):r||e)}),t});e.exports=o},function(e,t,r){var n=r(185),i=500;e.exports=function(e){var t=n(e,function(e){return r.size===i&&r.clear(),e}),r=t.cache;return t}},function(e,t,r){var n=r(38),i="Expected a function";function o(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError(i);var r=function(){var n=arguments,i=t?t.apply(this,n):n[0],o=r.cache;if(o.has(i))return o.get(i);var a=e.apply(this,n);return r.cache=o.set(i,a)||o,a};return r.cache=new(o.Cache||n),r}o.Cache=n,e.exports=o},function(e,t,r){var n=r(187);e.exports=function(e){return null==e?"":n(e)}},function(e,t,r){var n=r(13),i=r(44),o=r(1),a=r(43),s=1/0,u=n?n.prototype:void 0,c=u?u.toString:void 0;e.exports=function e(t){if("string"==typeof t)return t;if(o(t))return i(t,e)+"";if(a(t))return c?c.call(t):"";var r=t+"";return"0"==r&&1/t==-s?"-0":r}},function(e,t,r){var n=r(189),i=r(190);e.exports=function(e,t){return null!=e&&i(e,t,n)}},function(e,t){e.exports=function(e,t){return null!=e&&t in Object(e)}},function(e,t,r){var n=r(75),i=r(30),o=r(1),a=r(29),s=r(28),u=r(24);e.exports=function(e,t,r){for(var c=-1,l=(t=n(t,e)).length,f=!1;++c<l;){var p=u(t[c]);if(!(f=null!=e&&r(e,p)))break;e=e[p]}return f||++c!=l?f:!!(l=null==e?0:e.length)&&s(l)&&a(p,l)&&(o(e)||i(e))}},function(e,t,r){var n=r(192),i=r(193),o=r(42),a=r(24);e.exports=function(e){return o(e)?n(a(e)):i(e)}},function(e,t){e.exports=function(e){return function(t){return null==t?void 0:t[e]}}},function(e,t,r){var n=r(74);e.exports=function(e){return function(t){return n(t,e)}}},function(e,t,r){var n=r(61),i=r(195),o=r(41),a=r(1);e.exports=function(e,t){return(a(e)?n:i)(e,o(t,3))}},function(e,t,r){var n=r(23);e.exports=function(e,t){var r=[];return n(e,function(e,n,i){t(e,n,i)&&r.push(e)}),r}},function(e,t,r){var n=r(60),i=r(23),o=r(76),a=r(1);e.exports=function(e,t){return(a(e)?n:i)(e,o(t))}},function(e,t,r){var n=r(44),i=r(41),o=r(198),a=r(1);e.exports=function(e,t){return(a(e)?n:o)(e,i(t,3))}},function(e,t,r){var n=r(23),i=r(8);e.exports=function(e,t){var r=-1,o=i(e)?Array(e.length):[];return n(e,function(e,n,i){o[++r]=t(e,n,i)}),o}},function(e,t,r){var n=r(200),i=r(9);e.exports=function(e){return null==e?[]:n(e,i(e))}},function(e,t,r){var n=r(44);e.exports=function(e,t){return n(t,function(t){return e[t]})}},function(e,t,r){var n=r(11),i=r(5),o="[object Number]";e.exports=function(e){return"number"==typeof e||i(e)&&n(e)==o}},function(e,t){e.exports={handleError:function(e){}}},function(e,t,r){var n=r(4);e.exports={dispatchEvent:function(e,t){var r,n=e.url,o=e.params;"POST"===e.httpVerb?((r=new XMLHttpRequest).open("POST",n,!0),r.setRequestHeader("Content-Type","application/json"),r.onreadystatechange=function(){if(4===r.readyState&&t&&"function"==typeof t)try{t(o)}catch(e){}},r.send(JSON.stringify(o))):(n+="?wxhr=true",o&&(n+="&"+i(o)),(r=new XMLHttpRequest).open("GET",n,!0),r.onreadystatechange=function(){if(4===r.readyState&&t&&"function"==typeof t)try{t()}catch(e){}},r.send())}};var i=function(e){return n.map(e,function(e,t){return encodeURIComponent(t)+"="+encodeURIComponent(e)}).join("&")}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){var t=e.timeout,r=e.callback;this.timeout=t,this.callback=r}return e.prototype.start=function(){this.timeoutId=setTimeout(this.callback,this.timeout)},e.prototype.refresh=function(){this.stop(),this.start()},e.prototype.stop=function(){this.timeoutId&&clearTimeout(this.timeoutId)},e}(),i=function(){function e(e){var t=e.sink;this.sink=t}return e.prototype.start=function(){},e.prototype.stop=function(){return Promise.resolve()},e.prototype.enqueue=function(e){this.sink([e])},e}();t.SingleEventQueue=i;var o=function(){function e(e){var t=e.flushInterval,r=e.maxQueueSize,i=e.sink;this.buffer=[],this.maxQueueSize=Math.max(r,1),this.sink=i,this.timer=new n({callback:this.flush.bind(this),timeout:t})}return e.prototype.start=function(){},e.prototype.stop=function(){var e=this.sink(this.buffer);return this.timer.stop(),e},e.prototype.enqueue=function(e){0===this.buffer.length&&this.timer.refresh(),this.buffer.push(e),this.buffer.length>=this.maxQueueSize&&this.flush()},e.prototype.flush=function(){this.sink(this.buffer),this.buffer=[],this.timer.stop()},e}();t.DefaultEventQueue=o},function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(10),o=r(206),a=r(0),s=i.getLogger("EventProcessor"),u=function(){function e(e){var t=e.eventDispatcher,r=e.store;this.dispatcher=t,this.store=r}return e.prototype.dispatchEvent=function(e,t){this.send({uuid:a.generateUUID(),timestamp:a.getTimestamp(),request:e},t)},e.prototype.sendPendingEvents=function(){var e=this,t=this.store.values();s.debug("Sending %s pending events from previous page",t.length),t.forEach(function(t){try{e.send(t,function(){})}catch(e){}})},e.prototype.send=function(e,t){var r=this;this.store.set(e.uuid,e),this.dispatcher.dispatchEvent(e.request,function(n){r.store.remove(e.uuid),t(n)})},e}();t.PendingEventsDispatcher=u;var c=function(e){function t(t){var r=t.eventDispatcher;return e.call(this,{eventDispatcher:r,store:new o.LocalStorageStore({maxValues:100,key:"fs_optly_pending_events"})})||this}return n(t,e),t}(u);t.LocalStoragePendingEventsDispatcher=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(10).getLogger("EventProcessor"),o=function(){function e(e){var t=e.key,r=e.maxValues,n=void 0===r?1e3:r;this.LS_KEY=t,this.maxValues=n}return e.prototype.get=function(e){return this.getMap()[e]||null},e.prototype.set=function(e,t){var r=this.getMap();r[e]=t,this.replace(r)},e.prototype.remove=function(e){var t=this.getMap();delete t[e],this.replace(t)},e.prototype.values=function(){return n.objectValues(this.getMap())},e.prototype.clear=function(){this.replace({})},e.prototype.replace=function(e){try{localStorage.setItem(this.LS_KEY,JSON.stringify(e)),this.clean()}catch(e){i.error(e)}},e.prototype.clean=function(){var e=this.getMap(),t=Object.keys(e),r=t.length-this.maxValues;if(!(r<1)){var n=t.map(function(t){return{key:t,value:e[t]}});n.sort(function(e,t){return e.value.timestamp-t.value.timestamp});for(var i=0;i<r;i++)delete e[n[i].key];this.replace(e)}},e.prototype.getMap=function(){try{var e=localStorage.getItem(this.LS_KEY);if(e)return JSON.parse(e)||{}}catch(e){i.error(e)}return{}},e}();t.LocalStorageStore=o},function(e,t,r){"use strict";var n=this&&this.__extends||function(){var e=function(t,r){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(t,r)};return function(t,r){function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=r(0),o=r(80),a=r(81),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.buildGroupByKey=function(e){return i.objectValues(e.context).join("|")},t.prototype.groupEvents=function(e){var t=this;return i.groupBy(e,function(e){return t.buildGroupByKey(e)})},t.prototype.formatEvents=function(e){return{url:"https://logx.optimizely.com/v1/events",httpVerb:"POST",params:a.makeBatchedEventV1(e)}},t}(o.AbstractEventProcessor);t.LogTierV1EventProcessor=s},function(e,t,r){var n=r(10);function i(){}i.prototype.log=function(){},e.exports={createLogger:function(e){return new n.ConsoleLogHandler(e)},createNoOpLogger:function(){return new i}}},function(e,t,r){var n=r(4),i=r(45),o=r(210),a=r(2),s=r(216),u=r(217),c=r(79),l=r(218),f=r(219),p=r(25),E=r(220),_=r(0).sprintf,v=r(221),g=r(82),d=r(78),h=a.ERROR_MESSAGES,I=a.LOG_LEVEL,y=a.LOG_MESSAGES,O="OPTIMIZELY",R=a.DECISION_SOURCES,N=a.FEATURE_VARIABLE_TYPES,T=a.DECISION_NOTIFICATION_TYPES,A=a.NOTIFICATION_TYPES,m=1,b=5e3;function S(e){var t=e.clientEngine;t!==a.NODE_CLIENT_ENGINE&&t!==a.JAVASCRIPT_CLIENT_ENGINE&&(e.logger.log(I.INFO,_(y.INVALID_CLIENT_ENGINE,O,t)),t=a.NODE_CLIENT_ENGINE),this.clientEngine=t,this.clientVersion=e.clientVersion||a.NODE_CLIENT_VERSION,this.errorHandler=e.errorHandler,this.eventDispatcher=e.eventDispatcher,this.isValidInstance=e.isValidInstance,this.logger=e.logger;try{d.validateDatafile(e.datafile),("string"==typeof e.datafile||e.datafile instanceof String)&&(e.datafile=JSON.parse(e.datafile)),!0===e.skipJSONValidation?(this.configObj=p.createProjectConfig(e.datafile),this.logger.log(I.INFO,_(y.SKIPPING_JSON_VALIDATION,O))):e.jsonSchemaValidator.validate(E,e.datafile)&&(this.configObj=p.createProjectConfig(e.datafile),this.logger.log(I.INFO,_(y.VALID_DATAFILE,O)))}catch(e){this.isValidInstance=!1,this.logger.log(I.ERROR,e.message),this.errorHandler.handleError(e)}var r=null;if(e.userProfileService)try{v.validate(e.userProfileService)&&(r=e.userProfileService,this.logger.log(I.INFO,_(y.VALID_USER_PROFILE_SERVICE,O)))}catch(e){this.logger.log(I.WARNING,e.message)}this.decisionService=o.createDecisionService({userProfileService:r,logger:this.logger}),this.notificationCenter=f.createNotificationCenter({logger:this.logger,errorHandler:this.errorHandler}),this.eventProcessor=new c.LogTierV1EventProcessor({dispatcher:this.eventDispatcher,flushInterval:e.eventFlushInterval||b,maxQueueSize:e.eventBatchSize||m}),this.eventProcessor.start()}S.prototype.activate=function(e,t,r){try{if(!this.isValidInstance)return this.logger.log(I.ERROR,_(y.INVALID_OBJECT,O,"activate")),null;if(!this.__validateInputs({experiment_key:e,user_id:t},r))return this.__notActivatingExperiment(e,t);try{var n=this.getVariation(e,t,r);if(null===n)return this.__notActivatingExperiment(e,t);if(!p.isRunning(this.configObj,e)){var i=_(y.SHOULD_NOT_DISPATCH_ACTIVATE,O,e);return this.logger.log(I.DEBUG,i),n}return this._sendImpressionEvent(e,n,t,r),n}catch(r){this.logger.log(I.ERROR,r.message);var o=_(y.NOT_ACTIVATING_USER,O,t,e);return this.logger.log(I.INFO,o),this.errorHandler.handleError(r),null}}catch(e){return this.logger.log(I.ERROR,e.message),this.errorHandler.handleError(e),null}},S.prototype._sendImpressionEvent=function(e,t,r,n){var i=u.buildImpressionEvent({experimentKey:e,variationKey:t,userId:r,userAttributes:n,clientEngine:this.clientEngine,clientVersion:this.clientVersion,configObj:this.configObj});this.eventProcessor.process(i),this.__emitNotificationCenterActivate(e,t,r,n)},S.prototype.__emitNotificationCenterActivate=function(e,t,r,n){var i,o=p.getVariationIdFromExperimentAndVariationKey(this.configObj,e,t),a=p.getExperimentId(this.configObj,e),u={attributes:n,clientEngine:this.clientEngine,clientVersion:this.clientVersion,configObj:this.configObj,experimentId:a,userId:r,variationId:o,logger:this.logger},c=s.getImpressionEvent(u),l=this.configObj.experimentKeyMap[e];l&&l.variationKeyMap&&(i=l.variationKeyMap[t]),this.notificationCenter.sendNotifications(A.ACTIVATE,{experiment:l,userId:r,attributes:n,variation:i,logEvent:c})},S.prototype.track=function(e,t,r,n){try{if(!this.isValidInstance)return void this.logger.log(I.ERROR,_(y.INVALID_OBJECT,O,"track"));if(!this.__validateInputs({user_id:t,event_key:e},r,n))return;if(!p.eventWithKeyExists(this.configObj,e))throw new Error(_(h.INVALID_EVENT_KEY,O,e));n=this.__filterEmptyValues(n);var i=u.buildConversionEvent({eventKey:e,eventTags:n,userId:t,userAttributes:r,clientEngine:this.clientEngine,clientVersion:this.clientVersion,configObj:this.configObj});this.eventProcessor.process(i),this.__emitNotificationCenterTrack(e,t,r,n)}catch(e){this.logger.log(I.ERROR,e.message),this.errorHandler.handleError(e);var o=_(y.NOT_TRACKING_USER,O,t);this.logger.log(I.INFO,o)}},S.prototype.__emitNotificationCenterTrack=function(e,t,r,n){try{var i={attributes:r,clientEngine:this.clientEngine,clientVersion:this.clientVersion,configObj:this.configObj,eventKey:e,eventTags:n,logger:this.logger,userId:t},o=s.getConversionEvent(i);this.notificationCenter.sendNotifications(A.TRACK,{eventKey:e,userId:t,attributes:r,eventTags:n,logEvent:o})}catch(e){this.logger.log(I.ERROR,e.message),this.errorHandler.handleError(e)}},S.prototype.getVariation=function(e,t,r){try{if(!this.isValidInstance)return this.logger.log(I.ERROR,_(y.INVALID_OBJECT,O,"getVariation")),null;try{if(!this.__validateInputs({experiment_key:e,user_id:t},r))return null;var i=this.configObj.experimentKeyMap[e];if(n.isEmpty(i))return this.logger.log(I.DEBUG,_(h.INVALID_EXPERIMENT_KEY,O,e)),null;var o=this.decisionService.getVariation(this.configObj,e,t,r),a=p.isFeatureExperiment(this.configObj,i.id)?T.FEATURE_TEST:T.AB_TEST;return this.notificationCenter.sendNotifications(A.DECISION,{type:a,userId:t,attributes:r||{},decisionInfo:{experimentKey:e,variationKey:o}}),o}catch(e){return this.logger.log(I.ERROR,e.message),this.errorHandler.handleError(e),null}}catch(e){return this.logger.log(I.ERROR,e.message),this.errorHandler.handleError(e),null}},S.prototype.setForcedVariation=function(e,t,r){if(!this.__validateInputs({experiment_key:e,user_id:t}))return!1;try{return p.setForcedVariation(this.configObj,e,t,r,this.logger)}catch(e){return this.logger.log(I.ERROR,e.message),this.errorHandler.handleError(e),!1}},S.prototype.getForcedVariation=function(e,t){if(!this.__validateInputs({experiment_key:e,user_id:t}))return null;try{return p.getForcedVariation(this.configObj,e,t,this.logger)}catch(e){return this.logger.log(I.ERROR,e.message),this.errorHandler.handleError(e),null}},S.prototype.__validateInputs=function(e,t,r){try{if(e.hasOwnProperty("user_id")){var n=e.user_id;if("string"!=typeof n||null===n||"undefined"===n)throw new Error(_(h.INVALID_INPUT_FORMAT,O,"user_id"));delete e.user_id}for(var o=Object.keys(e),a=0;a<o.length;a++){var s=o[a];if(!g.validate(e[s]))throw new Error(_(h.INVALID_INPUT_FORMAT,O,s))}return t&&i.validate(t),r&&l.validate(r),!0}catch(e){return this.logger.log(I.ERROR,e.message),this.errorHandler.handleError(e),!1}},S.prototype.__notActivatingExperiment=function(e,t){var r=_(y.NOT_ACTIVATING_USER,O,t,e);return this.logger.log(I.INFO,r),null},S.prototype.__filterEmptyValues=function(e){for(var t in e)!e.hasOwnProperty(t)||null!==e[t]&&void 0!==e[t]||delete e[t];return e},S.prototype.isFeatureEnabled=function(e,t,r){try{if(!this.isValidInstance)return this.logger.log(I.ERROR,_(y.INVALID_OBJECT,O,"isFeatureEnabled")),!1;if(!this.__validateInputs({feature_key:e,user_id:t},r))return!1;var n=p.getFeatureFromKey(this.configObj,e,this.logger);if(!n)return!1;var i=!1,o=this.decisionService.getVariationForFeature(this.configObj,n,t,r),a=o.variation,s={};a&&(i=a.featureEnabled,o.decisionSource===R.FEATURE_TEST&&(s={experimentKey:o.experiment.key,variationKey:o.variation.key},this._sendImpressionEvent(o.experiment.key,o.variation.key,t,r))),!0===i?this.logger.log(I.INFO,_(y.FEATURE_ENABLED_FOR_USER,O,e,t)):(this.logger.log(I.INFO,_(y.FEATURE_NOT_ENABLED_FOR_USER,O,e,t)),i=!1);var u={featureKey:e,featureEnabled:i,source:o.decisionSource,sourceInfo:s};return this.notificationCenter.sendNotifications(A.DECISION,{type:T.FEATURE,userId:t,attributes:r||{},decisionInfo:u}),i}catch(e){return this.logger.log(I.ERROR,e.message),this.errorHandler.handleError(e),!1}},S.prototype.getEnabledFeatures=function(e,t){try{var r=[];return this.isValidInstance?this.__validateInputs({user_id:e})?(n.forOwn(this.configObj.featureKeyMap,function(n){this.isFeatureEnabled(n.key,e,t)&&r.push(n.key)}.bind(this)),r):r:(this.logger.log(I.ERROR,_(y.INVALID_OBJECT,O,"getEnabledFeatures")),r)}catch(e){return this.logger.log(I.ERROR,e.message),this.errorHandler.handleError(e),[]}},S.prototype._getFeatureVariableForType=function(e,t,r,n,i){if(!this.isValidInstance){var o="getFeatureVariable"+r.charAt(0).toUpperCase()+r.slice(1);return this.logger.log(I.ERROR,_(y.INVALID_OBJECT,O,o)),null}if(!this.__validateInputs({feature_key:e,variable_key:t,user_id:n},i))return null;var a=p.getFeatureFromKey(this.configObj,e,this.logger);if(!a)return null;var s=p.getVariableForFeature(this.configObj,e,t,this.logger);if(!s)return null;if(s.type!==r)return this.logger.log(I.WARNING,_(y.VARIABLE_REQUESTED_WITH_WRONG_TYPE,O,r,s.type)),null;var u=!1,c=s.defaultValue,l=this.decisionService.getVariationForFeature(this.configObj,a,n,i);if(null!==l.variation){u=l.variation.featureEnabled;var f=p.getVariableValueForVariation(this.configObj,s,l.variation,this.logger);null!==f?!0===u?(c=f,this.logger.log(I.INFO,_(y.USER_RECEIVED_VARIABLE_VALUE,O,t,a.key,c,n))):this.logger.log(I.INFO,_(y.FEATURE_NOT_ENABLED_RETURN_DEFAULT_VARIABLE_VALUE,O,a.key,n,t)):this.logger.log(I.INFO,_(y.VARIABLE_NOT_USED_RETURN_DEFAULT_VARIABLE_VALUE,O,t,l.variation.key))}else this.logger.log(I.INFO,_(y.USER_RECEIVED_DEFAULT_VARIABLE_VALUE,O,n,t,a.key));var E={};l.decisionSource===R.FEATURE_TEST&&(E={experimentKey:l.experiment.key,variationKey:l.variation.key});var v=p.getTypeCastValue(c,r,this.logger);return this.notificationCenter.sendNotifications(A.DECISION,{type:T.FEATURE_VARIABLE,userId:n,attributes:i||{},decisionInfo:{featureKey:e,featureEnabled:u,source:l.decisionSource,variableKey:t,variableValue:v,variableType:r,sourceInfo:E}}),v},S.prototype.getFeatureVariableBoolean=function(e,t,r,n){try{return this._getFeatureVariableForType(e,t,N.BOOLEAN,r,n)}catch(e){return this.logger.log(I.ERROR,e.message),this.errorHandler.handleError(e),null}},S.prototype.getFeatureVariableDouble=function(e,t,r,n){try{return this._getFeatureVariableForType(e,t,N.DOUBLE,r,n)}catch(e){return this.logger.log(I.ERROR,e.message),this.errorHandler.handleError(e),null}},S.prototype.getFeatureVariableInteger=function(e,t,r,n){try{return this._getFeatureVariableForType(e,t,N.INTEGER,r,n)}catch(e){return this.logger.log(I.ERROR,e.message),this.errorHandler.handleError(e),null}},S.prototype.getFeatureVariableString=function(e,t,r,n){try{return this._getFeatureVariableForType(e,t,N.STRING,r,n)}catch(e){return this.logger.log(I.ERROR,e.message),this.errorHandler.handleError(e),null}},S.prototype.close=function(){try{this.eventProcessor.stop()}catch(e){this.logger.log(I.ERROR,e.message),this.errorHandler.handleError(e)}},e.exports=S},function(e,t,r){var n=r(211),i=r(214),o=r(2),a=r(4),s=r(25),u=r(0).sprintf,c="DECISION_SERVICE",l=o.ERROR_MESSAGES,f=o.LOG_LEVEL,p=o.LOG_MESSAGES,E=o.DECISION_SOURCES;function _(e){this.userProfileService=e.userProfileService||null,this.logger=e.logger}_.prototype.getVariation=function(e,t,r,n){var o=this._getBucketingId(r,n);if(!this.__checkIfExperimentIsActive(e,t,r))return null;var a=e.experimentKeyMap[t],l=s.getForcedVariation(e,t,r,this.logger);if(l)return l;var E=this.__getWhitelistedVariation(a,r);if(E)return E.key;var _=this.__resolveExperimentBucketMap(r,n);if(E=this.__getStoredVariation(e,a,r,_))return this.logger.log(f.INFO,u(p.RETURNING_STORED_VARIATION,c,E.key,t,r)),E.key;if(!this.__checkIfUserIsInAudience(e,t,r,n))return null;var v=this.__buildBucketerParams(e,t,o,r),g=i.bucket(v);return(E=e.variationIdMap[g])?(this.__saveUserProfile(a,E,r,_),E.key):null},_.prototype.__resolveExperimentBucketMap=function(e,t){t=t||{};var r=this.__getUserProfile(e)||{},n=t[o.CONTROL_ATTRIBUTES.STICKY_BUCKETING_KEY];return a.assignIn({},r.experiment_bucket_map,n)},_.prototype.__checkIfExperimentIsActive=function(e,t,r){if(!s.isActive(e,t)){var n=u(p.EXPERIMENT_NOT_RUNNING,c,t);return this.logger.log(f.INFO,n),!1}return!0},_.prototype.__getWhitelistedVariation=function(e,t){if(!a.isEmpty(e.forcedVariations)&&e.forcedVariations.hasOwnProperty(t)){var r=e.forcedVariations[t];if(e.variationKeyMap.hasOwnProperty(r)){var n=u(p.USER_FORCED_IN_VARIATION,c,t,r);return this.logger.log(f.INFO,n),e.variationKeyMap[r]}var i=u(p.FORCED_BUCKETING_FAILED,c,r,t);return this.logger.log(f.ERROR,i),null}return null},_.prototype.__checkIfUserIsInAudience=function(e,t,r,i){var o=s.getExperimentAudienceConditions(e,t),a=s.getAudiencesById(e);this.logger.log(f.DEBUG,u(p.EVALUATING_AUDIENCES_COMBINED,c,t,JSON.stringify(o)));var l=n.evaluate(o,a,i,this.logger);if(this.logger.log(f.INFO,u(p.AUDIENCE_EVALUATION_RESULT_COMBINED,c,t,l.toString().toUpperCase())),!l){var E=u(p.USER_NOT_IN_EXPERIMENT,c,r,t);return this.logger.log(f.INFO,E),!1}return!0},_.prototype.__buildBucketerParams=function(e,t,r,n){var i={};return i.experimentKey=t,i.experimentId=s.getExperimentId(e,t),i.userId=n,i.trafficAllocationConfig=s.getTrafficAllocation(e,t),i.experimentKeyMap=e.experimentKeyMap,i.groupIdMap=e.groupIdMap,i.variationIdMap=e.variationIdMap,i.logger=this.logger,i.bucketingId=r,i},_.prototype.__getStoredVariation=function(e,t,r,n){if(n.hasOwnProperty(t.id)){var i=n[t.id],o=i.variation_id;if(e.variationIdMap.hasOwnProperty(o))return e.variationIdMap[i.variation_id];this.logger.log(f.INFO,u(p.SAVED_VARIATION_NOT_FOUND,c,r,o,t.key))}return null},_.prototype.__getUserProfile=function(e){var t={user_id:e,experiment_bucket_map:{}};if(!this.userProfileService)return t;try{return this.userProfileService.lookup(e)}catch(t){this.logger.log(f.ERROR,u(l.USER_PROFILE_LOOKUP_ERROR,c,e,t.message))}},_.prototype.__saveUserProfile=function(e,t,r,n){if(this.userProfileService)try{var i=a.cloneDeep(n);i[e.id]={variation_id:t.id},this.userProfileService.save({user_id:r,experiment_bucket_map:i}),this.logger.log(f.INFO,u(p.SAVED_VARIATION,c,t.key,e.key,r))}catch(e){this.logger.log(f.ERROR,u(l.USER_PROFILE_SAVE_ERROR,c,r,e.message))}},_.prototype.getVariationForFeature=function(e,t,r,n){var i=this._getVariationForFeatureExperiment(e,t,r,n);if(null!==i.variation)return this.logger.log(f.DEBUG,u(p.USER_IN_FEATURE_EXPERIMENT,c,r,i.variation.key,i.experiment.key,t.key)),i;this.logger.log(f.DEBUG,u(p.USER_NOT_IN_FEATURE_EXPERIMENT,c,r,t.key));var o=this._getVariationForRollout(e,t,r,n);return null!==o.variation?(this.logger.log(f.DEBUG,u(p.USER_IN_ROLLOUT,c,r,t.key)),o):(this.logger.log(f.DEBUG,u(p.USER_NOT_IN_ROLLOUT,c,r,t.key)),o)},_.prototype._getVariationForFeatureExperiment=function(e,t,r,n){var i=null,o=null;if(t.hasOwnProperty("groupId")){var a=e.groupIdMap[t.groupId];a&&(i=this._getExperimentInGroup(e,a,r))&&-1!==t.experimentIds.indexOf(i.id)&&(o=this.getVariation(e,i.key,r,n))}else t.experimentIds.length>0?(i=s.getExperimentFromId(e,t.experimentIds[0],this.logger))&&(o=this.getVariation(e,i.key,r,n)):this.logger.log(f.DEBUG,u(p.FEATURE_HAS_NO_EXPERIMENTS,c,t.key));var l=null;return null!==o&&null!==i&&(l=i.variationKeyMap[o]),{experiment:i,variation:l,decisionSource:E.FEATURE_TEST}},_.prototype._getExperimentInGroup=function(e,t,r){var n=i.bucketUserIntoExperiment(t,r,r,this.logger);if(null!==n){this.logger.log(f.INFO,u(p.USER_BUCKETED_INTO_EXPERIMENT_IN_GROUP,c,r,n,t.id));var o=s.getExperimentFromId(e,n,this.logger);if(o)return o}return this.logger.log(f.INFO,u(p.USER_NOT_BUCKETED_INTO_ANY_EXPERIMENT_IN_GROUP,c,r,t.id)),null},_.prototype._getVariationForRollout=function(e,t,r,n){if(!t.rolloutId)return this.logger.log(f.DEBUG,u(p.NO_ROLLOUT_EXISTS,c,t.key)),{experiment:null,variation:null,decisionSource:E.ROLLOUT};var o=e.rolloutIdMap[t.rolloutId];if(!o)return this.logger.log(f.ERROR,u(l.INVALID_ROLLOUT_ID,c,t.rolloutId,t.key)),{experiment:null,variation:null,decisionSource:E.ROLLOUT};if(0===o.experiments.length)return this.logger.log(f.ERROR,u(p.ROLLOUT_HAS_NO_EXPERIMENTS,c,t.rolloutId)),{experiment:null,variation:null,decisionSource:E.ROLLOUT};var a,s,_,v,g,d=this._getBucketingId(r,n),h=o.experiments.length-1;for(a=0;a<h;a++){if(s=e.experimentKeyMap[o.experiments[a].key],this.__checkIfUserIsInAudience(e,s.key,r,n)){if(this.logger.log(f.DEBUG,u(p.USER_MEETS_CONDITIONS_FOR_TARGETING_RULE,c,r,a+1)),_=this.__buildBucketerParams(e,s.key,d,r),v=i.bucket(_),g=e.variationIdMap[v])return this.logger.log(f.DEBUG,u(p.USER_BUCKETED_INTO_TARGETING_RULE,c,r,a+1)),{experiment:s,variation:g,decisionSource:E.ROLLOUT};this.logger.log(f.DEBUG,u(p.USER_NOT_BUCKETED_INTO_TARGETING_RULE,c,r,a+1));break}this.logger.log(f.DEBUG,u(p.USER_DOESNT_MEET_CONDITIONS_FOR_TARGETING_RULE,c,r,a+1))}var I=e.experimentKeyMap[o.experiments[h].key];if(this.__checkIfUserIsInAudience(e,I.key,r,n)){if(_=this.__buildBucketerParams(e,I.key,d,r),v=i.bucket(_),g=e.variationIdMap[v])return this.logger.log(f.DEBUG,u(p.USER_BUCKETED_INTO_EVERYONE_TARGETING_RULE,c,r)),{experiment:I,variation:g,decisionSource:E.ROLLOUT};this.logger.log(f.DEBUG,u(p.USER_NOT_BUCKETED_INTO_EVERYONE_TARGETING_RULE,c,r))}return{experiment:null,variation:null,decisionSource:E.ROLLOUT}},_.prototype._getBucketingId=function(e,t){var r=e;return null!=t&&"object"==typeof t&&t.hasOwnProperty(o.CONTROL_ATTRIBUTES.BUCKETING_ID)&&("string"==typeof t[o.CONTROL_ATTRIBUTES.BUCKETING_ID]?(r=t[o.CONTROL_ATTRIBUTES.BUCKETING_ID],this.logger.log(f.DEBUG,u(p.VALID_BUCKETING_ID,c,r))):this.logger.log(f.WARNING,u(p.BUCKETING_ID_NOT_STRING,c))),r},e.exports={createDecisionService:function(e){return new _(e)}}},function(e,t,r){var n=r(212),i=r(213),o=r(2),a=r(0).sprintf,s=o.LOG_LEVEL,u=o.LOG_MESSAGES;e.exports={evaluate:function(e,t,r,o){if(!e||0===e.length)return!0;r||(r={});var c=function(e){return i.evaluate(e,r,o)};return n.evaluate(e,function(e){var r=t[e];if(r){o.log(s.DEBUG,a(u.EVALUATING_AUDIENCE,"AUDIENCE_EVALUATOR",e,JSON.stringify(r.conditions)));var i=n.evaluate(r.conditions,c),l=null===i?"UNKNOWN":i.toString().toUpperCase();return o.log(s.INFO,a(u.AUDIENCE_EVALUATION_RESULT,"AUDIENCE_EVALUATOR",e,l)),i}return null})||!1}}},function(e,t){var r="and",n="or",i="not",o=[r,n,i];function a(e,t){if(Array.isArray(e)){var s=e[0],u=e.slice(1);switch(-1===o.indexOf(s)&&(s=n,u=e),s){case r:return function(e,t){for(var r=!1,n=0;n<e.length;n++){var i=a(e[n],t);if(!1===i)return!1;null===i&&(r=!0)}return!r||null}(u,t);case i:return function(e,t){if(e.length>0){var r=a(e[0],t);return null===r?null:!r}return null}(u,t);default:return function(e,t){for(var r=!1,n=0;n<e.length;n++){var i=a(e[n],t);if(!0===i)return!0;null===i&&(r=!0)}return!!r&&null}(u,t)}}return t(e)}e.exports={evaluate:a}},function(e,t,r){var n=r(4),i=r(2),o=r(0).sprintf,a=i.LOG_LEVEL,s=i.LOG_MESSAGES,u="CUSTOM_ATTRIBUTE_CONDITION_EVALUATOR",c="custom_attribute",l="exists",f=["exact",l,"gt","lt","substring"],p={};function E(e){return"string"==typeof e||"boolean"==typeof e||n.isNumber(e)}function _(e,t,r){var i=e.value,c=typeof i,l=e.name,f=t[l],p=typeof f;return!E(i)||n.isNumber(i)&&!n.isFinite(i)?(r.log(a.WARNING,o(s.UNEXPECTED_CONDITION_VALUE,u,JSON.stringify(e))),null):null===f?(r.log(a.DEBUG,o(s.UNEXPECTED_TYPE_NULL,u,JSON.stringify(e),l)),null):E(f)&&c===p?n.isNumber(f)&&!n.isFinite(f)?(r.log(a.WARNING,o(s.OUT_OF_BOUNDS,u,JSON.stringify(e),l)),null):i===f:(r.log(a.WARNING,o(s.UNEXPECTED_TYPE,u,JSON.stringify(e),p,l)),null)}p.exact=_,p[l]=function(e,t){var r=t[e.name];return void 0!==r&&null!==r},p.gt=function(e,t,r){var i=e.name,c=t[i],l=typeof c,f=e.value;if(!n.isFinite(f))return r.log(a.WARNING,o(s.UNEXPECTED_CONDITION_VALUE,u,JSON.stringify(e))),null;if(null===c)return r.log(a.DEBUG,o(s.UNEXPECTED_TYPE_NULL,u,JSON.stringify(e),i)),null;if(!n.isNumber(c))return r.log(a.WARNING,o(s.UNEXPECTED_TYPE,u,JSON.stringify(e),l,i)),null;if(!n.isFinite(c))return r.log(a.WARNING,o(s.OUT_OF_BOUNDS,u,JSON.stringify(e),i)),null;return c>f},p.lt=function(e,t,r){var i=e.name,c=t[e.name],l=typeof c,f=e.value;if(!n.isFinite(f))return r.log(a.WARNING,o(s.UNEXPECTED_CONDITION_VALUE,u,JSON.stringify(e))),null;if(null===c)return r.log(a.DEBUG,o(s.UNEXPECTED_TYPE_NULL,u,JSON.stringify(e),i)),null;if(!n.isNumber(c))return r.log(a.WARNING,o(s.UNEXPECTED_TYPE,u,JSON.stringify(e),l,i)),null;if(!n.isFinite(c))return r.log(a.WARNING,o(s.OUT_OF_BOUNDS,u,JSON.stringify(e),i)),null;return c<f},p.substring=function(e,t,r){var n=e.name,i=t[e.name],c=typeof i,l=e.value;if("string"!=typeof l)return r.log(a.WARNING,o(s.UNEXPECTED_CONDITION_VALUE,u,JSON.stringify(e))),null;if(null===i)return r.log(a.DEBUG,o(s.UNEXPECTED_TYPE_NULL,u,JSON.stringify(e),n)),null;if("string"!=typeof i)return r.log(a.WARNING,o(s.UNEXPECTED_TYPE,u,JSON.stringify(e),c,n)),null;return-1!==i.indexOf(l)},e.exports={evaluate:function(e,t,r){if(e.type!==c)return r.log(a.WARNING,o(s.UNKNOWN_CONDITION_TYPE,u,JSON.stringify(e))),null;var n=e.match;if(void 0!==n&&-1===f.indexOf(n))return r.log(a.WARNING,o(s.UNKNOWN_MATCH_TYPE,u,JSON.stringify(e))),null;var i=e.name;return t.hasOwnProperty(i)||n==l?(p[n]||_)(e,t,r):(r.log(a.DEBUG,o(s.MISSING_ATTRIBUTE_VALUE,u,JSON.stringify(e),i)),null)}}},function(e,t,r){var n=r(2),i=r(215),o=r(0).sprintf,a=n.ERROR_MESSAGES,s=n.LOG_LEVEL,u=n.LOG_MESSAGES,c=Math.pow(2,32);e.exports={bucket:function(t){var r=t.experimentKeyMap[t.experimentKey].groupId;if(r){var n=t.groupIdMap[r];if(!n)throw new Error(o(a.INVALID_GROUP_ID,"BUCKETER",r));if("random"===n.policy){var i=e.exports.bucketUserIntoExperiment(n,t.bucketingId,t.userId,t.logger);if(null===i){var c=o(u.USER_NOT_IN_ANY_EXPERIMENT,"BUCKETER",t.userId,r);return t.logger.log(s.INFO,c),null}if(i!==t.experimentId){var l=o(u.USER_NOT_BUCKETED_INTO_EXPERIMENT_IN_GROUP,"BUCKETER",t.userId,t.experimentKey,r);return t.logger.log(s.INFO,l),null}var f=o(u.USER_BUCKETED_INTO_EXPERIMENT_IN_GROUP,"BUCKETER",t.userId,t.experimentKey,r);t.logger.log(s.INFO,f)}}var p=o("%s%s",t.bucketingId,t.experimentId),E=e.exports._generateBucketValue(p),_=o(u.USER_ASSIGNED_TO_VARIATION_BUCKET,"BUCKETER",E,t.userId);t.logger.log(s.DEBUG,_);var v=e.exports._findBucket(E,t.trafficAllocationConfig);if(null===v){var g=o(u.USER_HAS_NO_VARIATION,"BUCKETER",t.userId,t.experimentKey);t.logger.log(s.DEBUG,g)}else{if(""===v||!t.variationIdMap.hasOwnProperty(v)){var d=o(u.INVALID_VARIATION_ID,"BUCKETER");return t.logger.log(s.WARNING,d),null}var h=t.variationIdMap[v].key,I=o(u.USER_HAS_VARIATION,"BUCKETER",t.userId,h,t.experimentKey);t.logger.log(s.INFO,I)}return v},bucketUserIntoExperiment:function(t,r,n,i){var a=o("%s%s",r,t.id),c=e.exports._generateBucketValue(a);i.log(s.DEBUG,o(u.USER_ASSIGNED_TO_EXPERIMENT_BUCKET,"BUCKETER",c,n));var l=t.trafficAllocation;return e.exports._findBucket(c,l)},_findBucket:function(e,t){for(var r=0;r<t.length;r++)if(e<t[r].endOfRange)return t[r].entityId;return null},_generateBucketValue:function(e){try{var t=i.v3(e,1);return parseInt(1e4*(t/c),10)}catch(t){throw new Error(o(a.INVALID_BUCKETING_ID,"BUCKETER",e,t.message))}}}},function(e,t,r){!function(){function t(e,t){var r,n,i,o,a,s,u,c;for(r=3&e.length,n=e.length-r,i=t,a=3432918353,s=461845907,c=0;c<n;)u=255&e.charCodeAt(c)|(255&e.charCodeAt(++c))<<8|(255&e.charCodeAt(++c))<<16|(255&e.charCodeAt(++c))<<24,++c,i=27492+(65535&(o=5*(65535&(i=(i^=u=(65535&(u=(u=(65535&u)*a+(((u>>>16)*a&65535)<<16)&4294967295)<<15|u>>>17))*s+(((u>>>16)*s&65535)<<16)&4294967295)<<13|i>>>19))+((5*(i>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(u=0,r){case 3:u^=(255&e.charCodeAt(c+2))<<16;case 2:u^=(255&e.charCodeAt(c+1))<<8;case 1:i^=u=(65535&(u=(u=(65535&(u^=255&e.charCodeAt(c)))*a+(((u>>>16)*a&65535)<<16)&4294967295)<<15|u>>>17))*s+(((u>>>16)*s&65535)<<16)&4294967295}return i^=e.length,i=2246822507*(65535&(i^=i>>>16))+((2246822507*(i>>>16)&65535)<<16)&4294967295,i=3266489909*(65535&(i^=i>>>13))+((3266489909*(i>>>16)&65535)<<16)&4294967295,(i^=i>>>16)>>>0}var r=t;r.v2=function(e,t){for(var r,n=e.length,i=t^n,o=0;n>=4;)r=1540483477*(65535&(r=255&e.charCodeAt(o)|(255&e.charCodeAt(++o))<<8|(255&e.charCodeAt(++o))<<16|(255&e.charCodeAt(++o))<<24))+((1540483477*(r>>>16)&65535)<<16),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),n-=4,++o;switch(n){case 3:i^=(255&e.charCodeAt(o+2))<<16;case 2:i^=(255&e.charCodeAt(o+1))<<8;case 1:i=1540483477*(65535&(i^=255&e.charCodeAt(o)))+((1540483477*(i>>>16)&65535)<<16)}return i=1540483477*(65535&(i^=i>>>13))+((1540483477*(i>>>16)&65535)<<16),(i^=i>>>15)>>>0},r.v3=t,e.exports=r}()},function(e,t,r){var n=r(2),i=r(4),o=r(83),a=r(25),s=r(45),u="campaign_activated",c="custom",l="https://logx.optimizely.com/v1/events";function f(e){var t=e.attributes,r=e.configObj,o=r.anonymizeIP,u=r.botFiltering;null!==o&&void 0!==o||(o=!1);var l={snapshots:[],visitor_id:e.userId,attributes:[]},f={account_id:r.accountId,project_id:r.projectId,visitors:[l],revision:r.revision,client_name:e.clientEngine,client_version:e.clientVersion,anonymize_ip:o,enrich_decisions:!0};return i.forOwn(t,function(r,n){if(s.isAttributeValid(n,r)){var i=a.getAttributeId(e.configObj,n,e.logger);i&&f.visitors[0].attributes.push({entity_id:i,key:n,type:c,value:t[n]})}}),"boolean"==typeof u&&f.visitors[0].attributes.push({entity_id:n.CONTROL_ATTRIBUTES.BOT_FILTERING,key:n.CONTROL_ATTRIBUTES.BOT_FILTERING,type:c,value:u}),f}e.exports={getImpressionEvent:function(e){var t={httpVerb:"POST"},r=f(e);t.url=l;var n=function(e,t,r){return{decisions:[{campaign_id:a.getLayerId(e,t),experiment_id:t,variation_id:r}],events:[{entity_id:a.getLayerId(e,t),timestamp:i.currentTimestamp(),key:u,uuid:i.uuid()}]}}(e.configObj,e.experimentId,e.variationId);return r.visitors[0].snapshots.push(n),t.params=r,t},getConversionEvent:function(e){var t={httpVerb:"POST"},r=f(e);t.url=l;var s=function(e,t,r,s){var u={events:[]},c={entity_id:a.getEventId(e,t),timestamp:i.currentTimestamp(),uuid:i.uuid(),key:t};if(r){var l=o.getRevenueValue(r,s);null!==l&&(c[n.RESERVED_EVENT_KEYWORDS.REVENUE]=l);var f=o.getEventValue(r,s);null!==f&&(c[n.RESERVED_EVENT_KEYWORDS.VALUE]=f),c.tags=r}return u.events.push(c),u}(e.configObj,e.eventKey,e.eventTags,e.logger);return r.visitors[0].snapshots=[s],t.params=r,t}}},function(e,t,r){var n=r(10),i=r(45),o=r(4),a=r(83),s=r(25),u=n.getLogger("EVENT_BUILDER");function c(e,t){var r=[];return o.forOwn(t,function(n,o){if(i.isAttributeValid(o,n)){var a=s.getAttributeId(e,o,u);a&&r.push({entityId:a,key:o,value:t[o]})}}),r}t.buildImpressionEvent=function(e){var t=e.configObj,r=e.experimentKey,n=e.variationKey,i=e.userId,a=e.userAttributes,u=e.clientEngine,l=e.clientVersion,f=s.getVariationIdFromExperimentAndVariationKey(t,r,n),p=s.getExperimentId(t,r),E=s.getLayerId(t,p);return{type:"impression",timestamp:o.currentTimestamp(),uuid:o.uuid(),user:{id:i,attributes:c(t,a)},context:{accountId:t.accountId,projectId:t.projectId,revision:t.revision,clientName:u,clientVersion:l,anonymizeIP:t.anonymizeIP||!1,botFiltering:t.botFiltering},layer:{id:E},experiment:{id:p,key:r},variation:{id:f,key:n}}},t.buildConversionEvent=function(e){var t=e.configObj,r=e.userId,n=e.userAttributes,i=e.clientEngine,l=e.clientVersion,f=e.eventKey,p=e.eventTags,E=s.getEventId(t,f);return{type:"conversion",timestamp:o.currentTimestamp(),uuid:o.uuid(),user:{id:r,attributes:c(t,n)},context:{accountId:t.accountId,projectId:t.projectId,revision:t.revision,clientName:i,clientVersion:l,anonymizeIP:t.anonymizeIP||!1,botFiltering:t.botFiltering},event:{id:E,key:f},revenue:a.getRevenueValue(p,u),value:a.getEventValue(p,u),tags:p}}},function(e,t,r){var n=r(0).sprintf,i=r(2).ERROR_MESSAGES;e.exports={validate:function(e){if("object"!=typeof e||Array.isArray(e)||null===e)throw new Error(n(i.INVALID_EVENT_TAGS,"EVENT_TAGS_VALIDATOR"));return!0}}},function(e,t,r){var n=r(2),i=r(4),o=r(0).sprintf,a=n.LOG_LEVEL,s=n.LOG_MESSAGES;function u(e){this.logger=e.logger,this.errorHandler=e.errorHandler,this.__notificationListeners={},i.forOwn(n.NOTIFICATION_TYPES,function(e){this.__notificationListeners[e]=[]}.bind(this)),this.__listenerId=1}u.prototype.addNotificationListener=function(e,t){try{if(!(i.values(n.NOTIFICATION_TYPES).indexOf(e)>-1))return-1;this.__notificationListeners[e]||(this.__notificationListeners[e]=[]);var r=!1;if(i.forEach(this.__notificationListeners[e],function(e){if(e.callback===t)return r=!0,!1}),r)return-1;this.__notificationListeners[e].push({id:this.__listenerId,callback:t});var o=this.__listenerId;return this.__listenerId+=1,o}catch(e){return this.logger.log(a.ERROR,e.message),this.errorHandler.handleError(e),-1}},u.prototype.removeNotificationListener=function(e){try{var t,r;if(i.forOwn(this.__notificationListeners,function(n,o){if(i.forEach(n,function(n,i){if(n.id===e)return t=i,r=o,!1}),void 0!==t&&void 0!==r)return!1}),void 0!==t&&void 0!==r)return this.__notificationListeners[r].splice(t,1),!0}catch(e){this.logger.log(a.ERROR,e.message),this.errorHandler.handleError(e)}return!1},u.prototype.clearAllNotificationListeners=function(){try{i.forOwn(n.NOTIFICATION_TYPES,function(e){this.__notificationListeners[e]=[]}.bind(this))}catch(e){this.logger.log(a.ERROR,e.message),this.errorHandler.handleError(e)}},u.prototype.clearNotificationListeners=function(e){try{this.__notificationListeners[e]=[]}catch(e){this.logger.log(a.ERROR,e.message),this.errorHandler.handleError(e)}},u.prototype.sendNotifications=function(e,t){try{i.forEach(this.__notificationListeners[e],function(r){var n=r.callback;try{n(t)}catch(t){this.logger.log(a.ERROR,o(s.NOTIFICATION_LISTENER_EXCEPTION,"NOTIFICATION_CENTER",e,t.message))}}.bind(this))}catch(e){this.logger.log(a.ERROR,e.message),this.errorHandler.handleError(e)}},e.exports={createNotificationCenter:function(e){return new u(e)}}},function(e,t){e.exports={$schema:"http://json-schema.org/draft-04/schema#",type:"object",properties:{projectId:{type:"string",required:!0},accountId:{type:"string",required:!0},groups:{type:"array",items:{type:"object",properties:{id:{type:"string",required:!0},policy:{type:"string",required:!0},trafficAllocation:{type:"array",items:{type:"object",properties:{entityId:{type:"string",required:!0},endOfRange:{type:"integer",required:!0}}},required:!0},experiments:{type:"array",items:{type:"object",properties:{id:{type:"string",required:!0},key:{type:"string",required:!0},status:{type:"string",required:!0},layerId:{type:"string",required:!0},variations:{type:"array",items:{type:"object",properties:{id:{type:"string",required:!0},key:{type:"string",required:!0}}},required:!0},trafficAllocation:{type:"array",items:{type:"object",properties:{entityId:{type:"string",required:!0},endOfRange:{type:"integer",required:!0}}},required:!0},audienceIds:{type:"array",items:{type:"string"},required:!0},forcedVariations:{type:"object",required:!0}}},required:!0}}},required:!0},experiments:{type:"array",items:{type:"object",properties:{id:{type:"string",required:!0},key:{type:"string",required:!0},status:{type:"string",required:!0},layerId:{type:"string",required:!0},variations:{type:"array",items:{type:"object",properties:{id:{type:"string",required:!0},key:{type:"string",required:!0}}},required:!0},trafficAllocation:{type:"array",items:{type:"object",properties:{entityId:{type:"string",required:!0},endOfRange:{type:"integer",required:!0}}},required:!0},audienceIds:{type:"array",items:{type:"string"},required:!0},forcedVariations:{type:"object",required:!0}}},required:!0},events:{type:"array",items:{type:"object",properties:{key:{type:"string",required:!0},experimentIds:{type:"array",items:{type:"string",required:!0}},id:{type:"string",required:!0}}},required:!0},audiences:{type:"array",items:{type:"object",properties:{id:{type:"string",required:!0},name:{type:"string",required:!0},conditions:{type:"string",required:!0}}},required:!0},attributes:{type:"array",items:{type:"object",properties:{id:{type:"string",required:!0},key:{type:"string",required:!0}}},required:!0},version:{type:"string",required:!0},revision:{type:"string",required:!0}}}},function(e,t,r){var n=r(0).sprintf,i=r(2).ERROR_MESSAGES;e.exports={validate:function(e){if("function"!=typeof e.lookup)throw new Error(n(i.INVALID_USER_PROFILE_SERVICE,"USER_PROFILE_SERVICE_VALIDATOR","Missing function 'lookup'"));if("function"!=typeof e.save)throw new Error(n(i.INVALID_USER_PROFILE_SERVICE,"USER_PROFILE_SERVICE_VALIDATOR","Missing function 'save'"));return!0}}}])});